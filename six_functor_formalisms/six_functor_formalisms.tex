\documentclass[a4paper,dvipdfmx,11pt,reqno]{amsart}
\usepackage{amsmath,amsthm,amssymb,mathrsfs,stmaryrd}
\usepackage{bm}
\usepackage{url}
\usepackage{color}
\usepackage{eucal}
\usepackage{slashed}
\usepackage{physics}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{tikz-cd}
\usetikzlibrary{intersections, calc, arrows, arrows.meta, shadows}
\usepackage[utf8]{inputenc} % for special characters
\usepackage[T1]{fontenc}
\usepackage[backend=biber,style=alphabetic,hyperref=true]{biblatex} % for bib latex
\addbibresource{six_functor_formalisms.bib}
\usepackage{geometry} % margin settings
\geometry{margin=1.0in}
\usepackage{enumitem} % item style
\setlist[enumerate]{itemsep=2pt,parsep=2pt,before={\parskip=2pt}}
\setlist[description]{style=standard}
\usepackage[colorlinks=true,hyperindex, linkcolor=magenta, pagebackref=false, citecolor=cyan,pdfpagelabels]{hyperref} % link colors
\usepackage{cleveref}

\renewcommand{\baselinestretch}{1.1} % change the space between lines

% \tracinglostchars=2
% \usepackage{unicode-math}
% \setmathfont{NewCMMath-Book}
% \setmathfont{NewCMMath-Book}[version=bold]
% % \setmathfont{NewCMMath-Book}
% % \setmathfont{NewCMMath-Book}[
% %   version=bold,
% %   FakeBold = 1.2 ]

% Math Operators
\DeclareMathOperator{\Ob}{Ob}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Map}{Map}
\DeclareMathOperator{\myop}{op}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\Id}{Id}
\DeclareMathOperator{\h}{h}
\DeclareMathOperator{\N}{N}
\DeclareMathOperator{\rmD}{D}
\DeclareMathOperator*{\colim}{colim}
\DeclareMathOperator{\Fun}{Fun}
\DeclareMathOperator{\FunL}{Fun^{L}}
\DeclareMathOperator{\Ind}{Ind}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\Supp}{Supp}
\DeclareMathOperator{\Mul}{Mul}
\DeclareMathOperator{\Ker}{Ker}

% Redefinitions
\renewcommand{\ev}{\mathrm{ev}}
\renewcommand{\Im}{\mathrm{Im}}

% Blackboard bold symbols
\newcommand{\bbN}{\mathbb{N}}
\newcommand{\bbR}{\mathbb{R}}
\newcommand{\bbZ}{\mathbb{Z}}
\newcommand{\bbD}{\mathbb{D}}
\newcommand{\bbSigma}{\mathbbl{\Sigma}}
\newcommand{\vbbSigma}{\mathbbl{\Sigma}_{\mathrm{v}}}
\newcommand{\bbLambda}{\mathbbl{\Lambda}}
\newcommand{\Einf}{\mathbb{E}_{\infty}}

% Tensor with L
\newcommand{\otimesL}{\mathop{\otimes}\limits^{\mathrm{L}}}

% Categories (math-cal)
\newcommand{\A}{\mathcal{A}}
\newcommand{\B}{\mathcal{B}}
\newcommand{\C}{\mathcal{C}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\G}{\mathcal{G}}
\newcommand{\I}{\mathcal{I}}
\newcommand{\J}{\mathcal{J}}
\newcommand{\V}{\mathcal{V}}
\newcommand{\X}{\mathcal{X}}
\newcommand{\W}{\mathcal{W}}
\renewcommand{\H}{\mathcal{H}}
\renewcommand{\O}{\mathcal{O}}
\renewcommand{\P}{\mathcal{P}}
\renewcommand{\S}{\mathcal{S}}

% Categories (math-rm)
\newcommand{\Ab}{\mathrm{Ab}}
\newcommand{\An}{\mathrm{An}}
\newcommand{\AN}{\mathrm{AN}}
\newcommand{\Cat}{\mathrm{Cat}}
\newcommand{\Catst}{\mathrm{Cat}^{\mathrm{st}}}
\newcommand{\CMon}{\mathrm{CMon}}
\newcommand{\CAT}{\mathrm{CAT}}
\newcommand{\Open}{\mathrm{Open}}
\newcommand{\PrL}{\mathrm{Pr}^{\mathrm{L}}}
\newcommand{\Pshv}{\mathrm{Pshv}}
\newcommand{\Shv}{\mathrm{Shv}}
\newcommand{\TwAr}{\mathrm{TwAr}}
\newcommand{\Corr}{\mathrm{Corr}}
\newcommand{\Fin}{\mathrm{Fin}}
\newcommand{\core}{\mathrm{core}}
\newcommand{\GS}{\mathrm{GS}}
\newcommand{\CG}{\mathrm{CG}}
\newcommand{\CGWH}{\mathrm{CGWH}}
\newcommand{\CHaus}{\mathrm{CHaus}}
\newcommand{\CondAn}{\mathrm{CondAn}}
\newcommand{\CondSet}{\mathrm{CondSet}}
\newcommand{\qcCondSet}{\mathrm{qcCondSet}}
\newcommand{\qsCondSet}{\mathrm{qsCondSet}}
\newcommand{\qcqsCondSet}{\mathrm{qcqsCondSet}}
\newcommand{\Cont}{\mathrm{Cont}}
\newcommand{\EDis}{\mathrm{EDis}}
\newcommand{\Set}{\mathrm{Set}}
\newcommand{\Prof}{\mathrm{Prof}}
\newcommand{\TDis}{\mathrm{TDis}}
\newcommand{\Top}{\mathrm{Top}}
\newcommand{\HypShv}{\mathrm{HypShv}}
\newcommand{\CAlg}{\mathrm{CAlg}}
\newcommand{\Mod}{\mathrm{Mod}}

\renewcommand{\angle}[1]{\left\langle #1 \right\rangle}

% Hiragana yo and oy
\DeclareFontFamily{U}{dmjhira}{}
\DeclareFontShape{U}{dmjhira}{m}{n}{<-> dmjhira}{}
\DeclareFontSubstitution{U}{dmjhira}{m}{n}
\newcommand{\yo}{\text{{\usefont{U}{dmjhira}{m}{n}\symbol{"48}}}}
\newcommand{\oy}{\text{{\reflectbox{\yo}}}}

% Prism
\usepackage{relsize}
\usepackage[bbgreekl]{mathbbol}
\DeclareSymbolFontAlphabet{\mathbb}{AMSb}
\DeclareSymbolFontAlphabet{\mathbbl}{bbold}
\newcommand{\prism}{{\mathlarger{\mathbbl{\Delta}}}}

% theorem style (using definition style)
\newtheorem{theorem}{Theorem}[section]
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{construction}[theorem]{Construction}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{example}[theorem]{Example}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{remark}[theorem]{Remark}

% Customizing clever-ref 
\crefname{notation}{Notation}{Notations}

% ------------------------------------------------------


\title{A Note on 6-functor formalisms (Under Construction)}
\author{Keima Akasaka}

\begin{document}

\maketitle 

\begin{abstract}
  We summarize key concepts and results on 6-functor formalisms, focusing on their foundational aspects.
\end{abstract} 

\setcounter{tocdepth}{2} % show depth in contents
\tableofcontents   


\section{Introduction}

The aim of this note is to explain \textit{what a 6-functor formalism is} and summarize the basic results and examples of 6-functor formalisms.
A 6-functor formalism is a framework to formalize a cohomology theory, which provide a structured and systematic approach to handling cohomological operations. 

The concept of six functors for sheaves originated in Grothendieck's work, and these are often referred to as Grothendieck's six operations.
The first such formalism was developed to establish the \'{e}tale cohomology of schemes, as formulated by Yifeng Liu and Weizhe Zheng \cite{LZ17}.
A subsequent formalism, intended for coherent cohomology of schemes, was provided by Dennis Gaitsgory and Nick Rozenblyum \cite{GR17}. 
The former approach is based on heavy combinatorics of specific simplicial sets, while the latter uses the framework of $(\infty,2)$-categories. 
More recently, Lucas Mann \cite{Mann22} has proposed a refined definition that combines favorable aspects of both methods.
We will present Mann's definition after reviewing classical sheaf theory and Grothendieck's six operations.

% In \cref{sec.classical_sheaf_theory}, we review classical sheaf theory with a focus on the proper base change theorem and projection formula. 
% (The abstract theory of derived categories and derived functors is summarized in \cref{sec.derived_categories}.) 
% In \cref{sec.six_functors_formalisms}, we introduce 6-functor formalisms and present some fundamental propositions.

\begin{notation}
  We let 
  \begin{itemize}
    \item $\Ab$ denote the category of abelian groups.
    \item $\Pshv(X)$ denote the category of presheaves on a topological space $X$.
    \item $\Shv(X)$ denote the category of sheaves on a topological space $X$.
    \item $\Cat$ denote the $\infty$-category of small $\infty$-categories.
  \end{itemize}  
\end{notation}


\section{Classical Sheaf Theory} \label{sec.classical_sheaf_theory}

In this section, we review the fundamental concepts and results of classical sheaf theory and Grothendieck's six functors. 
In \cref{subsec.the_category_of_sheaves}, we cover basic notions of the category of sheaves and the global section functor. 
In \cref{subsec.six_operations_on_the_category,subsec.six_operations_on_the_derived_category}, we construct the six functors on the (derived) category of sheaves. 
In \cref{subsec.remarkable_results}, we highlight key results in sheaf theory: the proper base change theorem and projection formula. 
% Finally, in \cref{subsec.poincare_duality}, we discuss classical Poincar\'{e} duality.

\subsection{The Category of Sheaves} \label{subsec.the_category_of_sheaves}

\begin{definition}
  Let $X$ be a topological space.
  An (\textit{abelian}) \textit{presheaf} on $X$ is a functor 
  \begin{align*}
    F : \Open(X)^{\myop} \to \Ab.
  \end{align*}
  A \textit{morphism of presheaves} is a natural transformation between presheaves.
  We let $\Pshv(X)$ denote the category of presheaves on $X$ with morphisms of presheaves, and refer to it as the \textit{category of presheaves} on $X$.
\end{definition}

\begin{definition}
  Let $X$ be a topological space, and let $F$ be a presheaf on $X$.
  We will say that $F$ is a \textit{sheaf} if, for every complete full subcategory $\mathcal{U}$ of $\Open(X)$, $F$ carries every colimit which exists in $\mathcal{U}$ to a limit in $\Ab$.
  We let $\Shv(X)$ denote the full subcategory of $\Pshv(X)$ spanned by sheaves on $X$, and refer to it as the \textit{category of sheaves} on $X$.
\end{definition}

\begin{proposition}
  Let $X$ be a topological space.
  By the adjoint functor theorem, the inclusion $\Shv(X) \subseteq \Pshv(X)$ admits a left adjoint, called the \textit{sheafification functor}
  \begin{align*}
    (-)^{+} : \Pshv(X) \to \Shv(X).
  \end{align*}
\end{proposition}

\begin{definition}
  Let $X$ be a topological space, and let $F$ be a sheaf on $X$.
  For an open subset $U$ of $X$, an element of $F(U)$ is called a \textit{section} on $U$ of $F$.
  In particular, an element of $F(X)$ is called a \textit{global section} of $F$.
  The construction $F \mapsto F(X)$ defines the \textit{global section functor}
  \begin{align*}
    \Gamma(X;-) : \Shv(X) \to \Ab.
  \end{align*}
\end{definition}

\begin{definition}
  Let $X$ be a topological space, $F$ be a sheaf on $X$, $U$ be an open subset of $X$, and let $s$ be a section on $U$ of $F$.
  A \textit{support} $\supp(s)$ of $s$ is the complement set $U \backslash V$, where $V$ is the largest open subset of $X$ on which $s|_{V}=0$.
\end{definition}

We can define the \textit{kernel sheaf} $\Ker \varphi$ and the \textit{image sheaf} $\Im \varphi$ for a morphism $\varphi$ of sheaves, and they endow an abelian category structure on the category of sheaves.
Then we can consider exact sequences of sheaves.

\begin{proposition}
  Let $X$ be a topological space.
  Then the category $\Shv(X)$ is an abelian category which has enough injectives.
\end{proposition}

\begin{definition}
  A sequence of sheaves $F \xrightarrow{\varphi} G \xrightarrow{\psi} H$ is called \textit{exact} if it satisfies $\Im \varphi = \Ker \psi$.
\end{definition}

\begin{proposition}
  Let $X$ be a topological space.
  Then the global section functor $\Gamma(X;-) : \Shv(X) \to \Ab$ is left exact.
  That is, for every short exact sequence of sheaves $0 \to F \to G \to H \to 0$, $0 \to \Gamma(X;F) \to \Gamma(X;G) \to \Gamma(X;H)$ is exact in $\Ab$.
\end{proposition}

\subsection{Grothendieck's Six Functors on the Category of Sheaves} \label{subsec.six_operations_on_the_category}

In this section, we recall Grothendieck's six functors.
We first discuss how to construct a new sheaf from the given sheaves.

\begin{definition}
  Let $X$ be a topological space, and let $F$ and $G$ be sheaves on $X$.
  For every open subset $U$ of $X$, we define 
  \begin{align*}
    \underline{\Hom}(F,G)(U) := \Hom_{\Shv(X)}(F|_{U},G|_{U}),
  \end{align*}
  which induces a sheaf $\underline{\Hom}(F,G)$ on $X$.
  The construction $(F,G) \mapsto \underline{\Hom}(F,G)$ defines a bifunctor 
  \begin{align*}
    \underline{\Hom} : \Shv(X)^{\myop} \times \Shv(X) \to \Shv(X).
  \end{align*} 
  We will refer to it as the \textit{sheaf hom functor}.
\end{definition}

\begin{definition}
  Let $X$ be a topological space, and let $F$ and $G$ be sheaves on $X$.
  For every open subset $U$ of $X$, we define 
  \begin{align*}
    F \otimes' G(U) := F(U) \otimes_{\bbZ} G(U),
  \end{align*}
  which induces a presheaf $F \otimes' G$ on $X$.
  We let $F \otimes G := (F \otimes' G)^{+}$ denote the sheafification of $F \otimes' G$.
  The construction $(F,G) \mapsto F \otimes G$ defines a bifunctor 
  \begin{align*}
    \otimes : \Shv(X) \times \Shv(X) \to \Shv(X).
  \end{align*}
  We will refer to it as the \textit{tensor product functor}.
\end{definition}

\begin{proposition}
  Let $X$ be a topological space.
  The tensor product functor $\otimes : \Shv(X) \times \Shv(X) \to \Shv(X)$ defines a symmetric monoidal structure on $\Shv(X)$.
\end{proposition}

\begin{proposition}
  Let $X$ be a topological space.
  Then there exists the following adjunction: 
  For every objects $F,G$ and $H$ of $\Shv(X)$, we have an isomorphism
  \begin{align*}
    \Hom_{\Shv(X)}(F \otimes G,H) \simeq \Hom_{\Shv(X)}(F,\underline{\Hom}(G,H)).
  \end{align*}
\end{proposition}

\begin{proposition}
  The tensor product functor $\otimes$ is right exact, and the sheaf hom functor $\underline{\Hom}$ is left exact. 
\end{proposition}

We next study the operators which transform sheaves along a continuous map between topological spaces.

\begin{definition}
  Let $f : X \to Y$ be a continuous map of topological spaces, and let $F$ be a sheaf on $X$.
  For every open subset $V$ of $Y$, we define 
  \begin{align*}
    f_{\ast}F(V) := \Gamma(f^{-1}(V);F) =  F(f^{-1}(V)),
  \end{align*}
  which induces a sheaf $f_{\ast}F$ on $Y$.
  The construction $F \mapsto f_{\ast}F$ defines a functor 
  \begin{align*}
    f_{\ast} : \Shv(X) \to \Shv(Y).
  \end{align*}
  We will refer to it as the \textit{direct image functor} or the \textit{pushout functor}.
  \[\begin{tikzpicture}[auto,->] 
    \node (tl) at (0,1.5) {$\Open(X)^{\myop}$}; 
    \node (bl) at (0,0) {$\Open(Y)^{\myop}$}; 
    \node (br) at (3,0) {$\Ab.$}; 
    % horizontal line 
    \draw (bl) -- node[swap] {$f_{\ast}F$} (br); 
    % vertical line
    \draw (bl) -- node {$(f^{-1})^{\myop}$} (tl);
    % from tl to br
    \draw (tl) -- node {$F$} (br); 
  \end{tikzpicture}\]
\end{definition}

We can construct a left adjoint functor to the direct image functor using the left Kan extension.

\begin{definition}
  Let $f : X \to Y$ be a continuous map of topological spaces, and let $G$ be a sheaf on $Y$.
  For every open subset $U$ of $X$, we define 
  \begin{align*}
    f'G(U) := \colim\limits_{f(U) \subset V} G(V),
  \end{align*}
  which induces a presheaf $f'G$ on $X$.
  We let $f^{\ast}G := (f'G)^{+}$ denote the sheafification of $f'G$.
  The construction $G \mapsto f^{\ast}G$ defines a functor 
  \begin{align*}
    f^{\ast} : \Shv(Y) \to \Shv(X).
  \end{align*}
  We will refer to it as the \textit{inverse image functor} or the \textit{pullback functor}.
  \[\begin{tikzpicture}[auto,->] 
    \node (tl) at (0,1.5) {$\Open(X)^{\myop}$}; 
    \node (bl) at (0,0) {$\Open(Y)^{\myop}$}; 
    \node (br) at (3,0) {$\Ab.$}; 
    % horizontal line 
    \draw (bl) -- node[swap] {$G$} (br); 
    % vertical line
    \draw (bl) -- node {$(f^{-1})^{\myop}$} (tl);
    % from tl to br
    \draw (tl) -- node {$f^{\ast}G$} (br); 
  \end{tikzpicture}\]
\end{definition}

\begin{proposition}
  Let $f : X \to Y$ be a continuous map of topological spaces.
  Then there exists the following adjunction 
  \begin{align*}
    f^{\ast} : \Shv(Y) \rightleftarrows \Shv(X) : f_{\ast}.
  \end{align*}
\end{proposition}

\begin{proposition}
  Let $f : X \to Y$ be a continuous map of topological spaces.
  Then the inverse image functor $f^{\ast}$ is exact, and the direct image functor $f_{\ast}$ is left exact.
\end{proposition}

In the rest of this section, we will consider the fifth functor, the \textit{proper direct image functor}.
It does not admit a right adjoint functor in the setting of the category of sheaves. 
From here all topological spaces are assumed to be (finite-dimensional) locally compact Hausdorff.

\begin{definition}
  Let $f : X \to Y$ be a continuous map of topological spaces.
  We will say that $f$ is \textit{proper} if, for every compact subset $K$ of $Y$, the inverse image $f^{-1}(K)$ is a compact subset of $X$.  
\end{definition}

The properness of continuous maps can be verified locally; 
in other words, properness is a local property.

\begin{definition}
  Let $f : X \to Y$ be a continuous map of topological spaces, and let $F$ be a sheaf on $X$.
  For every open subset $V$ of $Y$, we define 
  \begin{align*}
    f_{!}F(V) := \{s \in f_{\ast}F(V) ~|~ f|_{\supp(s)} : \supp(s) \to V \text{ is proper}\},
  \end{align*}
  which induces a sheaf $f_{!}F$ on $Y$.
  The construction $F \mapsto f_{!}F$ defines a functor 
  \begin{align*}
    f_{!} : \Shv(X) \to \Shv(Y).
  \end{align*}
  We will refer to it as the \textit{proper direct image functor}.
\end{definition}

\begin{remark}
  Let $f : X \to Y$ be a continuous map of topological spaces.
  Is there a right adjoint functor $f^{!} : \Shv(Y) \to \Shv(X)$ to the proper direct image functor $f_{!}$?
  The answer is "No," except in the case where $f$ is an inclusion of closed subsets. 
  This is because $f_{!}$ is not exact.
  However, this problem will be solved in the setting of the derived category of sheaves.
\end{remark}

\subsection{Grothendieck's Six Functors on the Derived Category of Sheaves} \label{subsec.six_operations_on_the_derived_category}

In this section, we consider Grothendieck's six functors in the setting of derived categories (see \cref{sec.derived_categories} for notations).
We first consider the derived functors of the sheaf hom functor $\underline{\Hom}$ and the tensor product functor $\otimes$. 

\begin{definition}
  Let $X$ be a topological space, and let $F$ and $G$ be objects of $C(\Shv(X))$.
  For every $n \geq 0$, we define 
  \begin{align*}
    \underline{\Hom}^n(F,G):= \prod_{i \in \bbZ} \underline{\Hom}(F^i,G^{n+i}),
  \end{align*}
  which induces a bifunctor $\underline{\Hom}^{\bullet} : K(\Shv(X))^{\myop} \times K(\Shv(X)) \to K(\Shv(X))$.
  Moreover, it induces the right derived functor 
  \begin{align*}
    \bbR \underline{\Hom} : D(X)^{\myop} \times D(X) \to D(X)
  \end{align*}
  of the sheaf hom functor $\underline{\Hom} : \Shv(X)^{\myop} \times \Shv(X) \to \Shv(X)$.
  It can be calculated as follows:
  For every objects $F$ and $G$ of $D(X)$, $\bbR \underline{\Hom}(F,G) = Q \circ \underline{\Hom}^{\bullet}(F,G')$, where $G'$ is quasi-isomorphic to $G$ in $K(\Shv(X))$ consisting of flabby sheaves (\cref{Ike.1.2.1}).
\end{definition}

\begin{definition}
  Let $X$ be a topological space, and let $F$ and $G$ be objects of $C(\Shv(X))$.
  For every $n \geq 0$, we define 
  \begin{align*}
    F \otimes^n G := \bigoplus_{i+j=n} F^i \otimes G^j,
  \end{align*}
  which induces a bifunctor $\otimes^{\bullet} : K(\Shv(X)) \times K(\Shv(X)) \to K(\Shv(X))$.
  Moreover, it induces the right derived functor 
  \begin{align*}
    \otimesL : D(X) \times D(X) \to D(X)
  \end{align*}
  of the tensor product functor $\otimes : \Shv(X) \times \Shv(X) \to \Shv(X)$.
  It can be calculated as follows:
  For every objects $F$ and $G$ of $D(X)$, $F \otimesL G = F' \otimes^{\bullet} G$, where $F'$ is quasi-isomorphic to $F$ in $K(\Shv(X))$ consisting of flat sheaves (\cref{Ike.2.2.4}). 
\end{definition}

\begin{proposition}
  Let $X$ be a topological space.
  The tensor product functor $\otimesL : D(X) \times D(X) \to D(X)$ defines a symmetric monoidal structure on $D(X)$.
\end{proposition}

\begin{proposition} \label{Ike.2.2.6}
  Let $X$ be a topological space.
  Then there exists the following adjunction: 
  For every objects $F, G$ and $H$ of $D(X)$, we have an isomorphism 
  \begin{align*}
    \bbR \Hom(F \otimesL G, H) \simeq \bbR \Hom(F, \bbR \underline{\Hom}(G,H)).
  \end{align*}
\end{proposition}

Recall that the direct image functor $f_{*}$ is left exact, and that the inverse image functor $f^{*}$ is exact.

\begin{definition} \label{Ike.2.1.23} % p78
  Let $f : X \to Y$ be a continuous map of topological spaces.
  Then there exists the right derived functor 
  \begin{align*}
    \bbR f_{*} : D(X) \to D(Y)
  \end{align*}
  of the direct image functor $f_{*} : \Shv(X) \to \Shv(Y)$.
  We will refer to it as the \textit{derived direct image functor}.
  It can be calculated as follows:
  For every object $F$ of $D(X)$, $\bbR f_{*}F = f_{*}F'$, where $F'$ is quasi-isomorphic to $F$ in $K(\Shv(X))$ consisting of flabby sheaves.
\end{definition}

\begin{definition} \label{Ike.2.1.32}
  Let $f : X \to Y$ be a continuous map of topological spaces.
  Then there exists the right derived functor 
  \begin{align*}
    \bbR f^{*} : D(Y) \to D(X)
  \end{align*}
  of the inverse image functor $f^{*} : \Shv(Y) \to \Shv(X)$.
  We will refer to it as the \textit{derived inverse image functor}.
  It can be calculated as follows:
  For every object $G$ of $D(Y)$, $\bbR f^{*}G = f^{*}G$, 
\end{definition}

\begin{proposition}
  Let $f : X \to Y$ be a continuous map of topological spaces.
  Then there exists the following adjunction 
  \begin{align*}
    \bbR f^{\ast} : D(Y) \rightleftarrows D(X) : \bbR f_{\ast}.
  \end{align*}
\end{proposition}

We next consider the derived functor the proper direct image functor $f_{!}$, and its right adjoint functor.

\begin{definition}
  Let $f : X \to Y$ be a continuous map of topological spaces.
  Then there exists the right derived functor 
  \begin{align*}
    \bbR f_{!} : D(X) \to D(Y)
  \end{align*}
  of the proper direct image functor $f_{!} : \Shv(X) \to \Shv(Y)$.
  We will refer to it as the \textit{derived proper direct image functor}.
  It can be calculated as follows:
  For every object $X$ of $D(X)$, $\bbR f_{!}F = f_{!}F'$, where $F'$ is a quasi-isomorphic object to $F$ in $K(\Shv(X))$ consisting of c-soft sheaves (\cref{Ike.2.2.12}).
\end{definition}

Let $f : X \to Y$ be a continuous map between topological spaces.
From here we assume the following condition:
\textit{The proper direct image functor $f_{!} : \Shv(X) \to \Shv(Y)$ has finite cohomology dimension}.

\begin{theorem}[Verdier Duality]
  Under the above assumption, there exists a functor
  \begin{align*}
    \bbR f^{!} : D(Y) \to D(X),
  \end{align*}
  which is right adjoint to the derived proper direct image functor $\bbR f_{!}$. 
  That is, there exists the following adjunction
  \begin{align*}
    \bbR f_{!} : D(X) \rightleftarrows D(Y) : \bbR f^{!}. 
  \end{align*}
  % That is, there exists a natural isomorphism 
  % \begin{align*}
  %   \bbR \Hom_{Y}(\bbR f_{!}F,G) \simeq \bbR \Hom_{X}(F,f^{!}G)
  % \end{align*}
  % for every object $F$ in $D(X)$ and $G$ in $D(Y)$.
\end{theorem}

\begin{definition}
  We will refer to the functor $\bbR f^{!} : D(Y) \to D(X)$ defined above as the \textit{exceptional inverse image functor}.
\end{definition}

% In the rest of this section, we define the composition operator of sheaves. (TBA) 
% % Write also Ike p99.

% \begin{definition} \label{Ike.2.2.23} 
  
% \end{definition}

\subsection{Sheaf Cohomology}

The goal of this section is to see some examples of six functors, and then define the sheaf cohomology and the cohomology of a topological space.

\begin{example}
  Let $X$ be a topological space, and let $F$ be a sheaf on $X$.
  Then we have an equivalence
  \begin{align*}
    F \otimes \underline{\bbZ} \simeq F \simeq \underline{\bbZ} \otimes F.
  \end{align*}
  That is, the constant sheaf $\underline{\bbZ}$ is a unit object of the symmetric monoidal structure on $\Shv(X)$.
  We denote this unit object by $\mathbf{1}$.
\end{example}

\begin{remark}
  Let $\ast$ be a topological space consisting of one point.
  Then there exists an equivalence of categories $\Shv(\ast) \simeq \Ab$.
\end{remark}

\begin{example} \label{Ike.eg.1.3.11}
  The direct image of the projection to a point agrees with the global section:
  Let $X$ be a topological space, and let $p: X \to \ast$ be the projection.
  For a sheaf $F$ on $X$, we have 
  \begin{align*}
    p_{\ast}F(\ast) \simeq \Gamma(p^{-1}(\ast);F) \simeq \Gamma(X;F).
  \end{align*}
  Then we obtain an equivalence of functors $p_{*} \simeq \Gamma(X:-) : \Shv(X) \to \Ab$.
\end{example}

\begin{example} \label{Ike.eg.1.3.20}
  The inverse image of the projection to a point agrees with the constant sheaf:
  Let $X$ be a topological space, and let $p: X \to \ast$ be the projection.
  For a sheaf $G$ on $\ast$, the value $G(\ast)$ can be identified with an abelian group $M$.
  We have
  \begin{align*}
    p'G(U) 
    \simeq \colim_{p(U) \subset \ast} G(\ast) 
    \simeq M,
  \end{align*} % p'G \simeq \underline{M}. 
  since the condition $p(U) \subset \ast$ is automatically satisfied.
  Thus its sheafification $p^{*}G$ is equivalent the constant sheaf $\underline{M}$.
  Then we obtain an equivalence of functors $p^{*} \simeq \underline{(-)} : \Ab \to \Shv(X)$.
\end{example}

\begin{remark}
  Let $X$ be a topological space, and let $p: X \to \ast$ be the projection.
  By \cref{Ike.eg.1.3.11,Ike.eg.1.3.20}, there exists the following adjunction
  \begin{align*}
    p^{*} \simeq \underline{(-)} : \Ab \rightleftarrows \Shv(X) : \Gamma(X;-) \simeq p_{*}.
  \end{align*}
  These derived functors define the following adjunction
  \begin{align*}
    p^{*} \simeq \underline{(-)} : D(\bbZ) \rightleftarrows D(X) : \bbR\Gamma(X;-) \simeq \bbR p_{*}.
  \end{align*}
\end{remark}

\begin{definition}
  Let $X$ be a topological space, and let $p: X \to \ast$ be the projection.
  We define the \textit{cohomology} $\bbR \Gamma(X;\bbZ)$ of $X$ by 
  \begin{align*}
    \bbR \Gamma(X;\bbZ) 
    := \bbR \Gamma(X;\mathbf{1}) 
    \simeq \bbR p_{*} \mathbf{1}.
  \end{align*}
  Similarly, we define the \textit{cohomology with compact support} $\bbR \Gamma_{c}(X;\bbZ)$ of $X$ by
  \begin{align*}
    \bbR \Gamma_{c}(X;\bbZ) 
    := \bbR p_{!} \mathbf{1}.
  \end{align*}
\end{definition}

\subsection{Some Remarkable Theorems} \label{subsec.remarkable_results}

In this section, we summarize notable results in sheaf theory, which are properties that 6-functor formalisms are expected to satisfy (see \cref{Mann.prop.A.5.8}).
From here we omit the term "derived" and the derived symbol $\bbR$.

\begin{proposition}[Naturality] \label{thrm.naturality}
  Let $f : X \to Y$ be a continuous map of topological spaces.
  Then the functors $f_{*}, f_{*}, f_{!}$ and $f^{!}$ are compatible with composition.
\end{proposition}

\begin{proposition}[Symmetric Monoidality] \label{thrm.symmetric_monoidality}
  Let $f : X \to Y$ be a continuous map of topological spaces.
  Then the inverse direct image $f^{*} : D(Y) \to D(X)$ is symmetric monoidal.
\end{proposition}

\begin{theorem}[Proper Base Change] \label{thrm.proper_base_change}
  For every Cartesian diagram of topological spaces
  \[\begin{tikzpicture}[auto,->] 
    \node (tl) at (0,1.5) {$X'$}; 
    \node (tr) at (1.5,1.5) {$X$};
    \node (bl) at (0,0) {$Y'$}; 
    \node (br) at (1.5,0) {$Y,$}; 
    % horizontal lines
    \draw (tl) -- node {$g'$} (tr); 
    \draw (bl) -- node[swap] {$g$} (br); 
    % vertical lines
    \draw (tl) -- node[swap] {$f'$} (bl);
    \draw (tr) -- node {$f$} (br); 
    % pullback symbol (\lrcorner) in the lower right corner of (tl)
    \node at ([xshift=0.0cm, yshift=-0.2cm] tl.south east) {$\lrcorner$};
  \end{tikzpicture}\]
  there exists a natural isomorphism 
  \begin{align*}
    g^{*}f_{!} \simeq f'_{!}g'^{*}
  \end{align*}
  of functors $D(X) \to D(Y')$.
  % \[\begin{tikzpicture}[auto,->] 
  %   \node (tl) at (0,1.5) {$D(X')$}; 
  %   \node (tr) at (2,1.5) {$D(X)$};
  %   \node (bl) at (0,0) {$D(Y')$}; 
  %   \node (br) at (2,0) {$D(Y)$}; 
  %   % horizontal lines
  %   \draw (tr) -- node[swap] {$g'^{*}$} (tl); 
  %   \draw (br) -- node {$g^{*}$} (bl); 
  %   % vertical lines
  %   \draw (tl) -- node[swap] {$f'_{!}$} (bl);
  %   \draw (tr) -- node {$f_{!}$} (br); 
  % \end{tikzpicture}\]
\end{theorem}

\begin{theorem}[Projection Formula] \label{thrm.projection_formula}
  Let $f : X \to Y$ be a proper map of topological spaces.
  Then there exist a natural isomorphism
  \begin{align*}
    f_{!}(-) \otimes (-) \to f_{!}((-) \otimes f^{*}(-))
  \end{align*}
  of functors $D(X) \times D(Y) \to D(Y)$
\end{theorem}

% \begin{theorem}[Projection Formula] \label{thrm.projection_formula}
%   Let $f : X \to Y$ be a proper map of topological spaces, $F$ be a sheaf on $X$, and let $G$ be a sheaf on $Y$.
%   Then the canonical map
%   \begin{align*}
%     f_{!}F \otimes G \to f_{!}(F \otimes f^{*}G)
%   \end{align*}
%   is an isomorphism in $D(Y)$.
% \end{theorem}

\begin{theorem}[K\"{u}nneth Formula]
  Let $X$ and $Y$ be topological spaces.
  Then the canonical map
  \begin{align*}
    \Gamma_{c}(X \times Y;\bbZ) \to \Gamma_{c}(X;\bbZ) \otimes \Gamma_{c}(Y;\bbZ).
  \end{align*}
  is an isomorphism in $D(\bbZ)$.
\end{theorem}

% % https://q.uiver.app/#q=WzAsMTUsWzAsMCwiXFxhc3QiXSxbNCw1LCJEKFIpIl0sWzAsNSwiRChSKSBcXHRpbWVzIEQoUikiXSxbMywwLCJEKFggXFx0aW1lcyBZKSJdLFsxLDEsIkQoWCkgXFx0aW1lcyBEKFkpIl0sWzIsMSwiRChYIFxcdGltZXMgWSkgXFx0aW1lcyBEKFggXFx0aW1lcyBZKSJdLFsxLDIsIkQoWSkgXFx0aW1lcyBEKFgpIl0sWzIsMiwiRChZKSBcXHRpbWVzIEQoWCBcXHRpbWVzIFkpIl0sWzMsMywiRChZKSJdLFsyLDMsIkQoWSkgXFx0aW1lcyBEKFkpIl0sWzEsMywiRChZKSBcXHRpbWVzIEQoUikiXSxbMiw0LCJEKFIpIFxcdGltZXMgRChZKSJdLFsyLDUsIkQoUikgXFx0aW1lcyBEKFIpIl0sWzQsMCwiRChSKSJdLFswLDQsIkQoWCkgXFx0aW1lcyBEKFkpIl0sWzAsMywiMV97WFl9Il0sWzQsNSwiKGZfe1h9XnsqfSwgZl97WX1eeyp9KSJdLFs1LDMsIlxcb3RpbWVzIiwyXSxbNiw3LCIoXFxpZCwgZl97WH1eeyp9KSIsMl0sWzcsNSwiKGZfe1l9XnsqfSwgXFxpZCkiLDJdLFszLDgsIntmX3tZfX1feyF9Il0sWzgsMSwie3Bfe1l9fV97IX0iLDJdLFs3LDksIihcXGlkLCB7Zl97WX19X3shfSkiXSxbOSw4LCJcXG90aW1lcyJdLFs2LDEwLCIoXFxpZCwge2Zfe1h9fV97IX0pIiwyXSxbMTAsOSwiKFxcaWQsIHBfe1l9XnsqfSkiLDJdLFsxMSw5LCIocF97WX1eeyp9LCBcXGlkKSIsMl0sWzYsOSwiKDUpIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzAsNCwiKDFfe1h9LDFfe1l9KSJdLFswLDYsIigxX3tZfSwxX3tYfSkiLDJdLFs1LDYsIigzKSIsMSx7InNob3J0ZW4iOnsic291cmNlIjoyMH0sImxldmVsIjoyLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMTEsMSwiKDcpIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzEyLDEsIlxcb3RpbWVzIiwyXSxbMTEsMTIsIihcXGlkLCB7cF97WX19X3shfSkiXSxbMiwxMiwiIiwxLHsibGV2ZWwiOjIsInN0eWxlIjp7ImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMywxMywicF8hIl0sWzEzLDEsIiIsMCx7ImxldmVsIjoyLCJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzMsMSwiKDEpIiwxLHsic2hvcnRlbiI6eyJzb3VyY2UiOjIwfSwibGV2ZWwiOjIsInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFswLDE0LCIoMV97WH0sMV97WX0pIiwyXSxbMTQsMTEsIih7cF97WH19X3shfSwgXFxpZCkiLDJdLFsxNCwxMCwiKDYpIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzE0LDIsIih7cF97WH19X3shfSwge3Bfe1l9fV97IX0pIiwyXSxbMTQsMTIsIig4KSIsMSx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsxNSwxNiwiKDIpIiwxLHsic2hvcnRlbiI6eyJzb3VyY2UiOjIwLCJ0YXJnZXQiOjIwfSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzE3LDgsIig0KSIsMSx7ImxldmVsIjoxLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XV0=
% \[\begin{tikzcd}
% 	\ast &&& {D(X \times Y)} & {D(R)} \\
% 	& {D(X) \times D(Y)} & {D(X \times Y) \times D(X \times Y)} \\
% 	& {D(Y) \times D(X)} & {D(Y) \times D(X \times Y)} \\
% 	& {D(Y) \times D(R)} & {D(Y) \times D(Y)} & {D(Y)} \\
% 	{D(X) \times D(Y)} && {D(R) \times D(Y)} \\
% 	{D(R) \times D(R)} && {D(R) \times D(R)} && {D(R)}
% 	\arrow[""{name=0, anchor=center, inner sep=0}, "{1_{XY}}", from=1-1, to=1-4]
% 	\arrow["{(1_{X},1_{Y})}", from=1-1, to=2-2]
% 	\arrow["{(1_{Y},1_{X})}"', from=1-1, to=3-2]
% 	\arrow["{(1_{X},1_{Y})}"', from=1-1, to=5-1]
% 	\arrow["{p_!}", from=1-4, to=1-5]
% 	\arrow["{{f_{Y}}_{!}}", from=1-4, to=4-4]
% 	\arrow["{(1)}"{description}, draw=none, from=1-4, to=6-5]
% 	\arrow[Rightarrow, no head, from=1-5, to=6-5]
% 	\arrow[""{name=1, anchor=center, inner sep=0}, "{(f_{X}^{*}, f_{Y}^{*})}", from=2-2, to=2-3]
% 	\arrow[""{name=2, anchor=center, inner sep=0}, "\otimes"', from=2-3, to=1-4]
% 	\arrow["{(3)}"{description}, draw=none, from=2-3, to=3-2]
% 	\arrow["{(\id, f_{X}^{*})}"', from=3-2, to=3-3]
% 	\arrow["{(\id, {f_{X}}_{!})}"', from=3-2, to=4-2]
% 	\arrow["{(5)}"{description}, draw=none, from=3-2, to=4-3]
% 	\arrow["{(f_{Y}^{*}, \id)}"', from=3-3, to=2-3]
% 	\arrow["{(\id, {f_{Y}}_{!})}", from=3-3, to=4-3]
% 	\arrow["{(\id, p_{Y}^{*})}"', from=4-2, to=4-3]
% 	\arrow["\otimes", from=4-3, to=4-4]
% 	\arrow["{{p_{Y}}_{!}}"', from=4-4, to=6-5]
% 	\arrow["{(6)}"{description}, draw=none, from=5-1, to=4-2]
% 	\arrow["{({p_{X}}_{!}, \id)}"', from=5-1, to=5-3]
% 	\arrow["{({p_{X}}_{!}, {p_{Y}}_{!})}"', from=5-1, to=6-1]
% 	\arrow["{(8)}"{description}, draw=none, from=5-1, to=6-3]
% 	\arrow["{(p_{Y}^{*}, \id)}"', from=5-3, to=4-3]
% 	\arrow["{(\id, {p_{Y}}_{!})}", from=5-3, to=6-3]
% 	\arrow["{(7)}"{description}, draw=none, from=5-3, to=6-5]
% 	\arrow[Rightarrow, no head, from=6-1, to=6-3]
% 	\arrow["\otimes"', from=6-3, to=6-5]
% 	\arrow["{(2)}"{description}, draw=none, from=0, to=1]
% 	\arrow["{(4)}"{description}, draw=none, from=2, to=4-4]
% \end{tikzcd}\]


\section{The Category of Correspondences} \label{sec.category_of_correspondences}

\subsection{Motivations}

Let us recall the setup of classical sheaf theory.
We work with the category $\C$ of locally compact Hausdorff topological spaces.
In this setting, there exists a class $E$ of morphisms in $\C$, where the exceptional functors $f_{!}$ and $f^{!}$ can be defined.
Then we can 
\begin{itemize}
  \item For every object $X$ of $\C$, we obtain the category $\rmD(X)$ of sheaves on $X$.
  \item For every morphism $f : X \to Y$ in $\C$, we have functors
  \begin{align*}
    f^{*} : \rmD(Y) \to \rmD(X)
    \quad \text{ and } \quad 
    f_{*} : \rmD(X) \to \rmD(Y).
  \end{align*}
  \item For every morphism $f : X \to Y$ in $E$, we can define functors
  \begin{align*}
    f_{!} : \rmD(X) \to \rmD(Y)
    \quad \text{ and } \quad 
    f^{!} : \rmD(Y) \to \rmD(X).
  \end{align*}
  \item Additionally, there exist bifunctors
  \begin{align*}
    \otimes : \rmD(X) \times \rmD(X) \to \rmD(X)
    \quad \text{ and } \quad 
    \underline{\Hom} : \rmD(X)^{\myop} \times \rmD(X) \to \rmD(X).
  \end{align*}
\end{itemize}

There is a natural map 
\begin{align*}
  \rmD(X) \otimes \rmD(Y) \to \rmD(X \times Y).
\end{align*}
For $Y=X$, this induces a morphism
\begin{align*}
  \rmD(X) \otimes \rmD(X) \to \rmD(X \times X) \xrightarrow{\Delta^{*}} \rmD(X),
\end{align*} 
where the second morphism is given by the diagonal $\Delta : X \to X \times X$.

In summary, the constructions $X \mapsto \rmD(X)$ and $f \mapsto f^{*}$ define a lax symmetric monoidal functor
\begin{align*}
  \rmD_{\C} : \C^{\myop} \to \Cat.
\end{align*} 
Similarly, the constructions $X \mapsto \rmD(X)$ and $f \mapsto f_{!}$ define a functor
\begin{align*}
  \rmD_{E} : \C_{E} \to \Cat,
\end{align*}
where $\C_{E}$ is the wide subcategory of $\C$ consisting of the morphisms in $E$.

To unify the different directions of morphisms $f^{*}$ and $f_{!}$, we consider the category $\Corr(\C,E)$ of correspondences:
\begin{itemize}
  \item The objects of $\Corr(\C,E)$ are the objects of $\C$.
  \item A morphism $X \to Y$ in $\Corr(\C,E)$ is a correspondence $X \leftarrow W \to Y$ in $\C$, where $W \to Y$ lies in $E$.
\end{itemize}
There are two inclusions
\begin{align*}
  \C^{\myop} \to \Corr(\C,E) 
  &: (f : X \to Y) \mapsto (Y \xleftarrow{f} X \xrightarrow{\id_{X}} X), \\
  E \to \Corr(\C,E) 
  &: (f : X \to Y) \mapsto (X \xleftarrow{\id_{X}} X \xrightarrow{f} Y).
\end{align*} 
Then the above discussion can be summarized as follows:
A 3-functor formalism is a lax symmetric monoidal functor
\begin{align*}
  \rmD : \Corr(\C,E) \to \Cat.
\end{align*}
To define a 6-functor formalism, we don't need any extra data.
That is, a 6-functor formalism is a special case of a 3-functor formalism, where 3-functors $\otimes$, $f^{*}$ and $f_{!}$ admit right adjoint functors.

In this section, we define the category of correspondences, which is a central ingredient in constructing 6-functor formalisms
From here all categories are assumed to be $\infty$-categories.

\subsection{Geometric Setups}

\begin{definition}[\cite{HM24} Definition 2.1.1] \label{HM24.def.2.1.1}
  A \textit{geometric setup} $(\C,\C_0)$ consists of a category $\C$ and a wide subcategory $\C_0$ of $\C$ satisfying the following conditions:
  \begin{enumerate}
    \setcounter{enumi}{-1}
    \item The category $\C$ admits pullbacks.
    \item The subcategory $\C_0$ is stable under pullbacks along morphisms in $\C$. 
    \item The subcategory $\C_0$ admits and the inclusion $\C_0 \subseteq \C$ preserves pullbacks.
  \end{enumerate}
\end{definition}

\begin{definition}
  Let $(\C,\C_0)$ and $(\C',\C'_0)$ be geometric setups.
  A \textit{morphism of geometric setups} from $(\C,\C_0)$ to $(\C',\C'_0)$ is a functor $f : \C \to \C'$ satisfying $f(\C_0) \subseteq \C'_0$.
  We let $\Fun^{\mathrm{GS}}(\C,\C')$ denote the full subcategory of $\Fun(\C,\C')$ spanned by morphisms of geometric setups.
\end{definition}

\begin{notation}
  We define the simplicial category $\GS^{\Delta}$ as follows:
  \begin{itemize}
    \item The objects of $\GS^{\Delta}$ are geometric setups.
    \item For every pair of objects $(\C,\C_0)$ and $(\C',\C'_0)$ of $\GS^{\Delta}$, the mapping space 
    \begin{align*}
      \Map_{\GS^{\Delta}}((\C,\C_0),(\C',\C'_0)) := \core\Fun^{\mathrm{GS}}(\C,\C').
    \end{align*}
  \end{itemize}
\end{notation}

By \cite[Proposition 1.1.5.10]{HTT}, the simplicial nerve of $\GS^{\Delta}$ is a category.

\begin{definition}
  We let $\GS$ denote the simplicial nerve $\N_{\Delta}(\GS^{\Delta})$.
  We will refer to $\GS$ as the \textit{category of geometric setups}.
\end{definition}

\begin{remark} \label{HM24.rem.2.1.2} % [\cite{HM24} Remark 2.1.2]
  We can identity a geometric setup $(\C,\C_0)$ with a pair $(\C,E)$ where $\C$ is a category and $E$ is a class of morphisms in $\C$ satisfying the following conditions:
  \begin{enumerate}
    \item The class $E$ contains all equivalences, is stable under composition and pullbacks along morphisms in $\C$.
    \item For every morphism $f : X \to Y$ in $E$, the diagonal $\Delta : X \to X \times_{Y} X$ lies in $E$ (see \cref{HM24.lem.2.1.5}).
  \end{enumerate}
  Similarly, We can identity a morphism $f : (\C,\C_0) \to (\C',\C'_0)$ of geometric setups with a functor $f : (\C,E) \to (\C',E)$ which preserves pullbacks of the form $X \leftarrow W \to Y$ where $W \to Y$ lies in $E$.

  Conversely, given a pair $(\C,E)$ which satisfies the above conditions, we can obtain a geometric setup $(\C,\C_{E})$ where $\C_{E}$ denote the wide subcategory of $\C$ consisting of the morphisms in $E$.
  Similarly, we can get a morphism of geometric setups.
\end{remark}

\begin{lemma}[\cite{HM24} Lemma 2.1.5] \label{HM24.lem.2.1.5}
  Let $\C$ be a category, and let $E$ be a class of morphisms in $E$ satisfying the condition (1) of \cref{HM24.rem.2.1.2}.
  The following conditions are equivalent:
  \begin{enumerate}
    \item The subcategory $\C_{E}$ satisfies the condition (2) of \cref{HM24.def.2.1.1}.
    \item The class $E$ satisfies the condition (2) of \cref{HM24.rem.2.1.2}.
    \item The class $E$ is right cancellative.
  \end{enumerate}
\end{lemma}

% \begin{example}[\cite{HM24} Example 2.1.4] \label{HM24.eg.2.1.4}
%   Let $\C$ be a category.
%   \begin{enumerate}
%     \item If $\C$ admits pullbacks, then the pair $(\C,\C)$ is a geometric setup.
%     \item The pair $(\C^{\myop},\core\C)$ is a geometric setup.
%   \end{enumerate}
% \end{example}

\subsection{The Category of Correspondences}

\begin{notation}[\cite{HM24} Definition 2.2.1] \label{HM24.def.2.2.1}
  Let $[n]$ be an object of $\prism$.
  \begin{enumerate}
    \item We define the simplicial set $\bbSigma^n$ by $\bbSigma^n_k := \Hom_{\mathrm{sSet}}([k] \star [k]^{\myop},[n])$
    % \begin{align*}
    %   \bbSigma^n_k := \Hom_{\mathrm{sSet}}([k] \star [k]^{\myop},[n])
    % \end{align*}
    for every $k \geq 0$.
    \item We let $\vbbSigma^n$ denote the subsimplicial set of $\bbSigma^n$ satisfying the following condition: 
    Its projection to the second component is a degenerate edge.
    \item We let $\bbLambda^n$ denote the subsimplicial set of $\bbSigma^n$ spanned by the image of objects $(i,j)$ of $[-] \star [-]^{\myop}$ satisfying $j \leq i+1$.
  \end{enumerate}
\end{notation}

\begin{remark}
  The simplicial set $\bbSigma^n$ is an example of twisted arrow categories (see \cite{HA} Construction 5.2.1.1).
  By \cite[Proposition 5.2.1.3]{HA}, $\bbSigma^n$ is a category.
  Then $\vbbSigma^n$ and $\bbLambda^n$ are full subcategories of $\bbSigma^n$.
\end{remark}

\begin{remark}
  Let $[n]$ be an object of $\prism$.
  % The construction $[n] \mapsto \bbSigma^n$ defines a cosimplicial category
  % \begin{align*}
  %   \bbSigma : \prism \to \Cat.
  % \end{align*}
  The pair $(\bbSigma^n, \vbbSigma^n)$ is a geometric setup by definition.
  Then the construction $[n] \mapsto (\bbSigma^n, \vbbSigma^n)$ defines cosimplicial object 
  \begin{align*}
    (\bbSigma^{-}, \vbbSigma^{-}) : \prism \to \GS.
  \end{align*}
\end{remark}

\begin{notation}
  Let $(\C,\C_0)$ be a geometric setup.
  We define the functor $\Corr(\C,\C_0) : \prism^{\myop} \to \An$ by 
  \begin{align*}
    \Corr(\C,\C_0)_n := \Map_{\GS}((\bbSigma^n, \vbbSigma^n), (\C,\C_0)) 
  \end{align*}
  for every $n \geq 0$.
\end{notation}

\begin{remark}
  The construction $[n] \mapsto \Corr(\C,\C_0)_n$ defines a cosimplicial anima 
  \begin{align*}
    \Corr(\C,\C_0) : \prism \to \An.
  \end{align*}
  The construction $(\C,\C_0) \mapsto \Corr(\C,\C_0)$ determines a functor
  \begin{align*}
    \Corr : \GS \to \Fun(\prism^{\myop},\An).
  \end{align*}
  \[\begin{tikzpicture}[auto,->] 
  \node (tl) at (0,1.5) {$\Fun(\prism^{\myop},\An)$}; 
  \node (bl) at (0,0) {$\prism$}; 
  \node (br) at (2.5,0) {$\GS.$}; 
  % horizontal line 
  \draw (bl) -- node[swap] {$(\bbSigma^{-}, \vbbSigma^{-})$} (br); 
  % vertical line
  \draw (bl) -- node {$\yo$} (tl);
  % from br to tl
  \draw (br) -- node[swap] {$\Corr$} (tl); 
\end{tikzpicture}\]
\end{remark}

\begin{lemma}[\cite{HM24} Lemma 2.1.6, 2.2.11]
  The category $\GS$ is complete, and the functor $\Corr : \GS \to \Fun(\prism^{\myop},\An)$ preserves limits.
\end{lemma}

The following proposition follows from the similar argument that Quillen's Q-construction defines a complete Segal anima in algebraic K-theory.

\begin{proposition}[\cite{HM24} Proposition 2.2.9] \label{HM24.prop.2.2.9}
  The functor $\Corr : \GS \to \Fun(\prism^{\myop},\An)$ factors through the full subcategory of complete Segal anima.
  That is, for every geometric setup $(\C,\C_0)$, the functor $\Corr(\C,\C_0) : \prism^{\myop} \to \An$ is a complete Segal anima.
\end{proposition}

\begin{definition}[\cite{HM24} Definition 2.2.10] \label{HM24.def.2.2.10}
  Let $(\C,\C_0)$ be a geometric setup.
  % The complete Segal anima can be identified with a category, which we will also denote by $\Corr(\C,\C_0)$.
  We will refer to the complete Segal anima $\Corr(\C,\C_0) : \prism^{\myop} \to \An$ as the \textit{category of correspondences}.
\end{definition}

\begin{remark}
  Let $(\C,\C_0)$ be a geometric setup.
  Then the lower simplices of $\Corr(\C,\C_0)$ can be described as follows:
  \begin{itemize}
    \item The objects of $\Corr(\C,\C_0)$ are the objects of $\C$.
    \item A morphism $X \to Y$ in $\Corr(\C,\C_0)$ is a correspondence
    \[\begin{tikzpicture}[auto,->]
      \node (11) at (0,3) {$X$};
      \node (12) at (1.5,3) {$X'$};
      \node (22) at (1.5,1.5) {$Y$};
      % horizontal lines
      \draw (12) -- node[swap] {$h$} (11);
      % vertical lines
      \draw (12) -- node {$v$} (22);
    \end{tikzpicture}\]
    in $\C$, where $X'$ is an object of $\C$ and $v$ is a morphism in $E$.
    \item A composition of morphisms $X \to Y$ and $Y \to Z$ in $\Corr(\C,E)$ represented by diagrams $X \xleftarrow{h_1} X' \xrightarrow{v_1} Y$ and $Y \xleftarrow{h_2} Y' \xrightarrow{v_2} Z$ in $\C$ respectively, is a correspondence
    \[\begin{tikzpicture}[auto,->]
      \node (11) at (0,3) {$X$};
      \node (12) at (1.5,3) {$X'$};
      \node (13) at (3.5,3) {$X \times_{Y} Y'$};
      \node (22) at (1.5,1.5) {$Y$};
      \node (23) at (3.5,1.5) {$Y'$};
      \node (33) at (3.5,0) {$Z$};
      % horizontal lines
      \draw (12) -- node[swap] {$h_1$} (11);
      \draw (13) -- node[swap] {} (12);
      \draw (23) -- node[swap] {$h_2$} (22);
      % vertical lines
      \draw (12) -- node {$v_1$} (22);
      \draw (13) -- node {} (23);
      \draw (23) -- node {$v_2$} (33);
      % pullback symbol
      \node at (3.1,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
    \end{tikzpicture}\] 
    in $\C$.
    Since $v_1$ and $v_2$ lie in $E$, the right vertical also lies in $E$.
  \end{itemize}
\end{remark}


\begin{remark} % [\cite{HM24} Remark 2.2.12] \label{HM24.rem.2.2.12}
  Let $[n]$ be an object of $\prism$.
  \begin{enumerate}
    \item The pair $([n],[n])$ is a geometric setup.
    The construction $[n] \mapsto ([n],[n])$ defines a cosimplicial object 
    \begin{align*}
      ([-],[-]) : \prism \to \GS.
    \end{align*}
    The construction $(\bbSigma^n, \vbbSigma^n) \mapsto ([n],[n])$ determines a map of cosimplicial objects 
    \begin{align*}
      \bbSigma^{-}, \vbbSigma^{-} \to ([-],[-]).
    \end{align*}
    Precomposing it induces a natural transformation 
    \begin{align*}
      \C_0 \to \Corr(\C,\C_0),
    \end{align*}  
    since we have an equivalence
    \begin{align*}
      \Hom_{\GS}(([-],[-]), (\C,\C_0)) \simeq \Hom_{\Cat}([-],\C_0).
    \end{align*}
    \item The pair $([n]^{\myop},\core[n])$ is a geometric setup.
    The construction $[n] \mapsto ([n]^{\myop},\core[n])$ defines a cosimplicial object 
    \begin{align*}
      ([-]^{\myop},\core[-]) : \prism \to \GS.
    \end{align*}
    The construction $(\bbSigma^n, \vbbSigma^n) \mapsto ([n]^{\myop},\core[n])$ determines a map of cosimplicial objects 
    \begin{align*}
      \bbSigma^{-}, \vbbSigma^{-} \to ([-]^{\myop},\core[-]).
    \end{align*}
    Precomposing it induces a natural transformation 
    \begin{align*}
      \C^{\myop} \to \Corr(\C,\C_0),
    \end{align*}  
    since we have an equivalence % (maybe)
    \begin{align*}
      \Hom_{\GS}(([-]^{\myop},\core[-]), (\C,\C_0)) \simeq \Hom_{\Cat}([-],\C^{\myop}).
    \end{align*}
  \end{enumerate}
\end{remark}

\subsection{The Operad Structure on \texorpdfstring{$\Corr(\C,\C_0)$}{Corr(C,C_0)}}

\begin{lemma}[\cite{HM24} Lemma 2.3.1] \label{HM24.lem.2.3.1}
  Let $(\C,\C_0)$ be a geometric setup.
  We denote 
  \begin{align*}
    \C_0^{-} := (\C_0^{\myop})^{\coprod,\myop} \times_{\Fin_{*}^{\myop}} \core\Fin_{*}.
  \end{align*}
  Then the pair $((\C_0^{\myop})^{\coprod,\myop}, \C_0^{-})$ is a geometric setup.
\end{lemma}

\begin{proposition}[\cite{HM24} Proposition 2.3.1] \label{HM24.prop.2.3.1}
  Let $(\C,\C_0)$ be a geometric setup.
  We denote 
  \begin{align*}
    \Corr(\C,\C_0)^{\otimes} := \Corr((\C_0^{\myop})^{\coprod,\myop}, \C_0^{-}).
  \end{align*}
  Then $\Corr(\C,\C_0)^{\otimes}$ is an operad whose underlying category is $\Corr(\C,\C_0)$.
\end{proposition}

\newpage


\section{Six-functor formalisms} \label{sec.six_functor_formalisms}

\subsection{Three-functor Formalisms}

\begin{definition}[\cite{HM24} Definition 3.1.1] \label{HM24.def.3.1.1}
  Let $(\C,E)$ be a geometric setup.
  A \textit{3-functor formalism} on $(\C,E)$ is a map of operads
  \begin{align*}
    \rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}.
  \end{align*}  
  % We will say that $\rmD$ is \textit{stable} (resp. \textit{presentable}) if it factors through the subcategory $\Catst$ (resp. $\PrL$).
\end{definition}

% \begin{remark}[\cite{HM24} Remark 3.1.2] \label{HM24.rem.3.1.2}
%   Let $(\C,E)$ be a geometric setup.
%   If $\C$ admits finite products, then $\Corr(\C,E)^{\otimes}$ is a symmetric monoidal category (non-trivial?). % LZ17 lemma.6.17
%   Thus a 3-functor formalism on $(\C,E)$ is a lax symmetric monoidal functor
%   \begin{align*}
%     \rmD : \Corr(\C,E) \to \Cat.
%   \end{align*}
% \end{remark}

\begin{remark} \label{nota.D_apper_ast}
  Let $(\C,E)$ be a geometric setup, and let $ \rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ be a 3-functor formalism on $(\C,E)$.
  \begin{enumerate}
    \item By precomposing $\rmD$ with the map of operads $(\C^{\myop})^{\coprod} \to \Corr(\C,E)^{\otimes}$, we obtain a map of operads $\rmD : (\C^{\myop})^{\coprod} \to \Cat^{\times}$.
    By \cite[Theorem 2.4.3.18]{HA}, it corresponds to a functor 
    \begin{align*}
      \rmD^{*} : \C^{\myop} \to \CMon.
    \end{align*}
    \item By precomposing $\rmD$ with the map of operads $\C_{E} \to \Corr(\C,E)^{\otimes}$, we obtain a map of operads (?) 
    \begin{align*}
      \rmD_{!} : \C_{E} \to \Cat^{\times}.
    \end{align*}
  \end{enumerate}
\end{remark}

\begin{notation} % [\cite{HM24} Definition 3.1.4] \label{HM24.def.3.1.4}
  Let $(\C,E)$ be a geometric setup, and let $ \rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ be a 3-functor formalism on $(\C,E)$.
  We will use the following notations.
  \begin{enumerate}
    \item For every object $X$ of $\C$, the category $\rmD(X) = \rmD^{*}(X)$ admits a symmetric monoidal structure, which we denote by 
    \begin{align*}
      \otimes : \rmD(X) \times \rmD(X) \to \rmD(X).
    \end{align*}
    \item For every morphism $f : X \to Y$ in $\C$, we obtain a symmetric monoidal functor 
    \begin{align*}
      f^{*} := \rmD^{\ast}(f) : \rmD(Y) \to \rmD(X).
    \end{align*}
    \item For every morphism $f : X \to Y$ in $E$, we obtain a functor
    \begin{align*}
      f_{!} := \rmD_{!}(f) : \rmD(X) \to \rmD(Y).
    \end{align*}
  \end{enumerate}
\end{notation}

\begin{lemma}
  Let $(\C,E)$ be a geometric setup, and let $ \rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ be a 3-functor formalism on $(\C,E)$.
  For every pair of morphisms $g : X' \to X$ in $\C$ and $f : X' \to Y$ in $E$, 
  % \[\begin{tikzpicture}[auto]
  %   \node (11) at (0,1.5) {$X$};
  %   \node (12) at (1.5,1.5) {$X'$};
  %   \node (22) at (1.5,0) {$Y.$};
  %   % horizontal lines
  %   \draw[->] (12) -- node[swap] {$g$} (11);
  %   % vertical lines
  %   \draw[->] (12) -- node {$f$} (22);
  % \end{tikzpicture}\]
  we obtain a natural morphism 
  \begin{align*}
    f_{!}g^{*} : \rmD(X) \to \rmD(Y).
  \end{align*}
  % \[\begin{tikzpicture}[auto]
  %   \node (11) at (0,1.5) {$\rmD(X)$};
  %   \node (12) at (2,1.5) {$\rmD(X')$};
  %   \node (22) at (2,0) {$\rmD(Y).$};
  %   % horizontal lines
  %   \draw[->] (11) -- node {$g^{*}$} (12);
  %   % vertical lines
  %   \draw[->] (12) -- node {$f_{!}$} (22);
  % \end{tikzpicture}\]
  \[\begin{tikzpicture}[auto]
    \node (11) at (0,1.5) {$X$};
    \node (12) at (1.5,1.5) {$X'$};
    \node (13) at (5,1.5) {$\rmD(X)$};
    \node (14) at (7,1.5) {$\rmD(X')$};
    \node (22) at (1.5,0) {$Y$};
    \node (24) at (7,0) {$\rmD(Y).$};
    % horizontal lines
    \draw[->] (13) -- node {$g^{*}$} (14);
    \draw[->] (12) -- node[swap] {$g$} (11);
    % vertical lines
    \draw[->] (12) -- node {$f$} (22);
    \draw[->] (14) -- node {$f_{!}$} (24);
    \draw[|->] (3,0.75) -- node {$\rmD$} (4,0.75);
  \end{tikzpicture}\]
\end{lemma}

\begin{proof}
  The morphisms $g : X' \to X$ in $\C$ and $f : X' \to Y$ in $E$ determines correspondences $h_1$ and $h_2$ respectively.
  \[\begin{tikzpicture}[auto]
    \node (11) at (0,1.5) {$X$};
    \node (12) at (1.5,1.5) {$X'$};
    \node (13) at (3,1.5) {$X'$};
    \node (14) at (4.5,1.5) {$X'$};
    \node (22) at (1.5,0) {$X'$};
    \node (24) at (4.5,0) {$Y.$};
    % horizontal lines
    \draw[transform canvas={yshift=1.5pt}] (14) -- (13);
    \draw[transform canvas={yshift=-1.5pt}] (14) -- (13);   
    \draw[->] (12) -- node[swap] {$g$} (11);
    % vertical lines
    \draw[transform canvas={xshift=1.5pt}] (12) -- (22);
    \draw[transform canvas={xshift=-1.5pt}] (12) -- (22);
    \draw[->] (14) -- node {$f$} (24);
  \end{tikzpicture}\]
  These morphisms define functors
  \begin{align*}
    g^{*} : \rmD(X) \to \rmD(X') 
    \quad \text{ and } \quad 
    f_{!} : \rmD(X') \to \rmD(Y)
  \end{align*}
  respectively.
  On the other hands, the composition $h_2h_1$ is given by the correspondence
  \[\begin{tikzpicture}[auto]
    \node (11) at (0,3) {$X$};
    \node (12) at (1.5,3) {$X'$};
    \node (13) at (3,3) {$X'$};
    \node (22) at (1.5,1.5) {$X'$};
    \node (23) at (3,1.5) {$X'$};
    \node (33) at (3,0) {$Y.$};
    % horizontal lines
    \draw[transform canvas={yshift=1.5pt}] (13) -- (12);
    \draw[transform canvas={yshift=-1.5pt}] (13) -- (12);   
    \draw[->] (12) -- node[swap] {$g$} (11);
    \draw[transform canvas={yshift=1.5pt}] (23) -- (22);
    \draw[transform canvas={yshift=-1.5pt}] (23) -- (22);   
    % vertical lines
    \draw[transform canvas={xshift=1.5pt}] (12) -- (22);
    \draw[transform canvas={xshift=-1.5pt}] (12) -- (22);
    \draw[transform canvas={xshift=1.5pt}] (13) -- (23);
    \draw[transform canvas={xshift=-1.5pt}] (13) -- (23);
    \draw[->] (23) -- node {$f$} (33);
    % pullback symbol
    \node at (2.6,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
  \end{tikzpicture}\] 
  Since $\rmD$ is a functor, we obtain 
  \begin{align*}
    \rmD(h_2h_1) 
    \simeq \rmD(h_2) \rmD(h_1) 
    \simeq f_{!}g^{*} : \rmD(X) \to \rmD(Y).
  \end{align*}
\end{proof}

\begin{proposition}[\cite{HM24} Proposition 3.1.8] \label{HM24.prop.3.1.8}
  Let $(\C,E)$ be a geometric setup, and let $ \rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ be a 3-functor formalism on $(\C,E)$.
  Then the associated three functors $\otimes, f^{*}$ and $f_{!}$ satisfy the following conditions:
  \begin{enumerate}
    \item The functors $f^{*}$ and $f_{!}$ are natural.
    \item For every morphism $f : X \to Y$ in $\C$, the functor $f^{*} : \rmD(Y) \to \rmD(X)$ is symmetric monoidal.
    \item (Proper base change) For every cartesian diagram in $\C$ 
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$X'$}; 
      \node (tr) at (1.5,1.5) {$X$};
      \node (bl) at (0,0) {$Y'$}; 
      \node (br) at (1.5,0) {$Y,$}; 
      % horizontal lines
      \draw (tl) -- node {$g'$} (tr); 
      \draw (bl) -- node[swap] {$g$} (br); 
      % vertical lines
      \draw (tl) -- node[swap] {$f'$} (bl);
      \draw (tr) -- node {$f$} (br); 
      % pullback symbol (\lrcorner) in the lower right corner of (tl)
      \node at ([xshift=0.0cm, yshift=-0.2cm] tl.south east) {$\lrcorner$};
    \end{tikzpicture}\]
    where $f$ in $E$ (thus also $f'$ in $E$), there exists a natural equivalence
    \begin{align*}
      g^{*}f_{!} \simeq f'_{!}g'^{*}
    \end{align*}
    of functors $\rmD(X) \to \rmD(Y')$.
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$\rmD(X')$}; 
      \node (tr) at (2,1.5) {$\rmD(X)$};
      \node (bl) at (0,0) {$\rmD(Y')$}; 
      \node (br) at (2,0) {$\rmD(Y).$}; 
      % horizontal lines
      \draw (tr) -- node[swap] {$g'^{*}$} (tl); 
      \draw (br) -- node {$g^{*}$} (bl); 
      % vertical lines
      \draw (tl) -- node[swap] {$f'_{!}$} (bl);
      \draw (tr) -- node {$f_{!}$} (br); 
    \end{tikzpicture}\]
    \item (The projection formula) For every morphism $f : X \to Y$ in $E$ and every pair of objects $F$ of $\rmD(X)$ and $G$ of $\rmD(Y)$,
    there exists a natural equivalence
    \begin{align*}
      f_{!}F \otimes G \to f_{!}(F \otimes f^{*}G)
    \end{align*}
    of functors $\rmD(X) \times \rmD(Y) \to \rmD(Y)$.
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,3) {$\rmD(Y) \times \rmD(Y)$}; 
      \node (tr) at (4,3) {$\rmD(X) \times \rmD(Y)$};
      \node (mr) at (4,1.5) {$\rmD(X) \times \rmD(X)$};
      \node (bl) at (0,0) {$\rmD(Y)$}; 
      \node (br) at (4,0) {$\rmD(X).$}; 
      % horizontal lines
      \draw (tr) -- node[swap] {$(f_!,\id_{\rmD(Y)})$} (tl); 
      \draw (br) -- node {$f_{!}$} (bl); 
      % vertical lines
      \draw (tl) -- node[swap] {$\otimes$} (bl);
      \draw (tr) -- node {$(\id_{\rmD(X)},f^{*})$} (mr);
      \draw (mr) -- node {$\otimes$} (br); 
    \end{tikzpicture}\]
  \end{enumerate}
\end{proposition}

\begin{proof}
  (1) and (2) follow from the definitions.

  We next show (3).
  The morphisms $f : X \to Y$ in $E$ and $g : Y' \to Y$ in $\C$ determine correspondences $h_1$ and $h_2$ respectively.
  \[\begin{tikzpicture}[auto]
    \node (11) at (0,1.5) {$X$};
    \node (12) at (1.5,1.5) {$X$};
    \node (13) at (3,1.5) {$Y$};
    \node (14) at (4.5,1.5) {$Y'$};
    \node (22) at (1.5,0) {$Y$};
    \node (24) at (4.5,0) {$Y'.$};
    % horizontal lines
    \draw[transform canvas={yshift=1.5pt}] (12) -- (11);
    \draw[transform canvas={yshift=-1.5pt}] (12) -- (11);   
    \draw[->] (14) -- node[swap] {$g$} (13);
    % vertical lines
    \draw[->] (12) -- node {$f$} (22);
    \draw[transform canvas={xshift=1.5pt}] (14) -- (24);
    \draw[transform canvas={xshift=-1.5pt}] (14) -- (24);
  \end{tikzpicture}\]
  The composition $h_2h_1$ is given by the correspondence
  \[\begin{tikzpicture}[auto]
    \node (11) at (0,3) {$X$};
    \node (12) at (1.5,3) {$X$};
    \node (13) at (3,3) {$X'$};
    \node (22) at (1.5,1.5) {$Y$};
    \node (23) at (3,1.5) {$Y'$};
    \node (33) at (3,0) {$Y'.$};
    % horizontal lines
    \draw[transform canvas={yshift=1.5pt}] (12) -- (11);
    \draw[transform canvas={yshift=-1.5pt}] (12) -- (11);   
    \draw[->] (13) -- node[swap] {$g'$} (12);
    \draw[->] (23) -- node[swap] {$g$} (22);
    % vertical lines
    \draw[->] (12) -- node {$f$} (22);
    \draw[->] (13) -- node {$f'$} (23);
    \draw[transform canvas={xshift=1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=-1.5pt}] (23) -- (33);
    % pullback symbol
    \node at (2.6,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
  \end{tikzpicture}\]
  The first map $h_1 : X \xleftarrow{\id_X} X \xrightarrow{f} Y$ defines a functor 
  \begin{align*}
    f_! : \rmD(X) \to \rmD(Y).
  \end{align*}
  The second map $h_2 : Y \xleftarrow{g'} Y' \xrightarrow{\id_{Y'}} Y'$ defines a functor 
  \begin{align*}
    g^{*} : \rmD(Y) \to \rmD(Y').
  \end{align*}
  The composition $h_2h_1 : X \xleftarrow{g'} X' \xrightarrow{f'} Y'$ defines a functor
  \begin{align*}
    f'_{!}g'^{*} : \rmD(X) \to \rmD(Y').
  \end{align*}
  Thus we obtain a natural equivalence $g^{*}f_{!} \simeq f'_{!}g'^{*}$, since $\rmD$ is a functor.

  We finally show (4).
  Let $f : X \to Y$ be a morphism in $E$.
  Consider the morphism $X \times Y \to Y$ given by the correspondence
  \[\begin{tikzpicture}[auto,->]
    \node (11) at (-0.5,3) {$X \times Y$};
    \node (12) at (1.5,3) {$X$};
    \node (22) at (1.5,1.5) {$Y.$};
    % horizontal lines
    \draw (12) -- node[swap] {$(\id_X,f)$} (11);
    % vertical lines
    \draw (12) -- node {$f$} (22);
  \end{tikzpicture}\]
  We obtain two factorizations of $X \times Y \to Y$ as follows:
  The morphism $X \times Y \to Y \times Y \to Y$ which is given by the correspondence
  \[\begin{tikzpicture}[auto]
    \node (11) at (-0.5,3) {$X \times Y$};
    \node (12) at (1.5,3) {$X \times Y$};
    \node (13) at (3.5,3) {$X$};
    \node (22) at (1.5,1.5) {$Y \times Y$};
    \node (23) at (3.5,1.5) {$Y$};
    \node (33) at (3.5,0) {$Y.$};
    % horizontal lines
    \draw[transform canvas={yshift=1.5pt}] (12) -- (11);
    \draw[transform canvas={yshift=-1.5pt}] (12) -- (11);
    \draw[->] (13) -- node[swap] {$(\id_X,f)$} (12);
    \draw[->] (23) -- node[swap]{$\Delta_Y$} (22);
    % vertical lines
    \draw[->] (12) -- node {$(f,\id_X)$} (22);
    \draw[->] (13) -- node {$f$} (23);
    \draw[transform canvas={xshift=1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=-1.5pt}] (23) -- (33);
    % pullback symbol
    \node at (3.1,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
  \end{tikzpicture}\]
  The morphism $X \times Y \to X \times X \to X \to Y$ which is given by the correspondence
  \[\begin{tikzpicture}[auto]
    \node (11) at (-1.5,4.5) {$X \times Y$};
    \node (12) at (1.0,4.5) {$X \times X$};
    \node (13) at (3,4.5) {$X$};
    \node (14) at (4.5,4.5) {$X$};
    \node (22) at (1.0,3) {$X \times X$};
    \node (23) at (3,3) {$X$};
    \node (24) at (4.5,3) {$X$};
    \node (33) at (3,1.5) {$X$};
    \node (34) at (4.5,1.5) {$X$};
    \node (44) at (4.5,0) {$Y.$};
    % horizontal lines
    \draw[->] (12) -- node[swap] {$(\id_X,f)$} (11);
    \draw[->] (13) -- node[swap] {$\Delta_X$} (12);
    \draw[transform canvas={yshift=1.5pt}] (14) -- (13);
    \draw[transform canvas={yshift=-1.5pt}] (14) -- (13);   
    \draw[->] (23) -- node[swap] {$\Delta_X$} (22);
    \draw[transform canvas={yshift=1.5pt}] (24) -- (23);
    \draw[transform canvas={yshift=-1.5pt}] (24) -- (23);  
    \draw[transform canvas={yshift=1.5pt}] (34) -- (33);
    \draw[transform canvas={yshift=-1.5pt}] (34) -- (33);  
    % vertical lines
    \draw[transform canvas={xshift=1.5pt}] (12) -- (22);
    \draw[transform canvas={xshift=-1.5pt}] (12) -- (22);
    \draw[transform canvas={xshift=1.5pt}] (13) -- (23);
    \draw[transform canvas={xshift=-1.5pt}] (13) -- (23);
    \draw[transform canvas={xshift=1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=-1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=1.5pt}] (14) -- (24);
    \draw[transform canvas={xshift=-1.5pt}] (14) -- (24);
    \draw[transform canvas={xshift=1.5pt}] (24) -- (34);
    \draw[transform canvas={xshift=-1.5pt}] (24) -- (34);
    \draw[transform canvas={xshift=1.5pt}] (34) -- (34);
    \draw[transform canvas={xshift=-1.5pt}] (34) -- (34);
    \draw[->] (34) -- node {$f$} (44);
    % pullback symbol
    \node at (2.6,4.1) {\rotatebox[origin=c]{90}{$\ulcorner$}};
    \node at (4.1,4.1) {\rotatebox[origin=c]{90}{$\ulcorner$}};
    \node at (4.1,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
  \end{tikzpicture}\]
  The considering morphism $X \times Y \xleftarrow{(\id_X,f)} X \xrightarrow{f} Y$ defines a functor 
  \begin{align*}
    \rmD(X) \times \rmD(Y) \to \rmD(Y).
  \end{align*}
  The first factorization $X \times Y \xleftarrow{(\id_X,f)} X \xrightarrow{f} Y$ defines a functor
  \begin{align*}
    &\rmD(X) \times \rmD(Y) \to \rmD(Y) \times \rmD(Y) \to \rmD(Y) \\
    &(F,G) \mapsto (f_{!}F, G) \mapsto f_{!}F \otimes G.
  \end{align*}
  The second factorization $X \times Y \xleftarrow{(\id_X,f)} X \times X \xleftarrow{\Delta_X} X \xrightarrow{f} Y$ defines a functor 
  \begin{align*}
    &\rmD(X) \times \rmD(Y) \to \rmD(X) \times \rmD(X) \to \rmD(X) \to \rmD(Y) \\
    &(F,G) \mapsto (F,f^{*}G) \mapsto F \otimes f^{*}G \mapsto f_!(F \otimes f^{*}G).
  \end{align*}
  This implies that a morphism $f_{!}F \otimes G \to f_!(F \otimes f^{*}G)$ is a natural equivalence in $\rmD(Y)$, since $\rmD$ is a functor.
\end{proof} 

\subsection{Six-functor formalisms}

\begin{definition}[\cite{HM24} Definition 3.2.1] \label{HM24.def.3.2.1}
  Let $(\C,E)$ be a geometric setup.
  A \textit{6-functor formalism} on $(\C,E)$ is a 3-functor formalism $\rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ satisfying the following conditions:
  \begin{enumerate}
    \item For every object $X$ of $\C$, the symmetric monoidal structure on $\rmD(X)$ is closed.
    \item The functors $f^{*} : \rmD(Y) \to \rmD(X)$ and $f_! : \rmD(X) \to \rmD(Y)$ admit right adjoint functors respectively.
  \end{enumerate}
\end{definition}

\begin{notation}
  Let $(\C,E)$ be a geometric setup, and let $D : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ be a 6-functor formalism on $(\C,E)$.
  We will use the following notations:
  \begin{enumerate}
    \item We denote the internal hom in $\rmD(X)$ (i.e. the right adjoint functor to $\otimes$) by 
    \begin{align*}
      \underline{\Hom} : \rmD(X)^{\myop} \times \rmD(X) \to \rmD(X).
    \end{align*}
    \item For every morphism $f : X \to Y$ in $\C$, we denote the right adjoint functor to $f^{*}$ by 
    \begin{align*}
      f_{*} : \rmD(X) \to \rmD(Y).
    \end{align*}
    % We denote by $D_{*} : \C \to \Cat$ determined by the constructions $X \mapsto \rmD(X)$ and $f \mapsto f_{*}$.
    \item For every morphism $f : X \to Y$ in $E$, we denote the right adjoint functor to $f_{!}$ by 
    \begin{align*}
      f^{!} : \rmD(Y) \to \rmD(X).
    \end{align*}
    % We denote by $D^{!} : \C_{E}^{\myop} \to \Cat$ determined by the constructions $X \mapsto \rmD(X)$ and $f \mapsto f^{!}$.
  \end{enumerate}
\end{notation}

\begin{proposition}[\cite{HM24} Proposition 3.2.2] \label{HM24.prop.3.2.2}
  Let $(\C,E)$ be a geometric setup, and let $D : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ be a 6-functor formalism on $(\C,E)$.
  Then the associated six functors $\otimes \dashv \underline{\Hom}$, $f^{*} \dashv f_{*}$ and $f_{!} \dashv f^{!}$ satisfy the following conditions:
  \begin{enumerate}
    \item The functors $f_{\ast}$ and $f^{!}$ are natural.
    \item For every cartesian diagram in $\C$ 
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$X'$}; 
      \node (tr) at (1.5,1.5) {$X$};
      \node (bl) at (0,0) {$Y'$}; 
      \node (br) at (1.5,0) {$Y,$}; 
      % horizontal lines
      \draw (tl) -- node {$g'$} (tr); 
      \draw (bl) -- node[swap] {$g$} (br); 
      % vertical lines
      \draw (tl) -- node[swap] {$f'$} (bl);
      \draw (tr) -- node {$f$} (br); 
      % pullback symbol (\lrcorner) in the lower right corner of (tl)
      \node at ([xshift=0.0cm, yshift=-0.2cm] tl.south east) {$\lrcorner$};
    \end{tikzpicture}\]
    where $f$ in $E$ (thus also $f'$ in $E$), there exists a natural equivalence
    \begin{align*}
      g^{!}f_{*} \simeq f'_{*}g'^{!}
    \end{align*}
    of functors $\rmD(X) \to \rmD(Y')$.
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$\rmD(X')$}; 
      \node (tr) at (2,1.5) {$\rmD(X)$};
      \node (bl) at (0,0) {$\rmD(Y')$}; 
      \node (br) at (2,0) {$\rmD(Y).$}; 
      % horizontal lines
      \draw (tr) -- node[swap] {$g'^{!}$} (tl); 
      \draw (br) -- node {$g^{!}$} (bl); 
      % vertical lines
      \draw (tl) -- node[swap] {$f'_{*}$} (bl);
      \draw (tr) -- node {$f_{*}$} (br); 
    \end{tikzpicture}\]
    % \item (the projection formula) For every morphism $f : X \to Y$ in $E$,
    % there exists a natural equivalence
    % \begin{align*}
    %   f_{!}(-) \otimes (-) \to f_{!}((-) \otimes f^{*}(-))
    % \end{align*}
    % of functors $\rmD(X) \times \rmD(Y) \to \rmD(Y)$.
    % \[\begin{tikzpicture}[auto,->] 
    %   \node (tl) at (0,3) {$\rmD(Y) \times \rmD(Y)$}; 
    %   \node (tr) at (4,3) {$\rmD(X) \times \rmD(Y)$};
    %   \node (mr) at (4,1.5) {$\rmD(X) \times \rmD(X)$};
    %   \node (bl) at (0,0) {$\rmD(Y)$}; 
    %   \node (br) at (4,0) {$\rmD(X).$}; 
    %   % horizontal lines
    %   \draw (tr) -- node[swap] {$(f_!,\id_{\rmD(Y)})$} (tl); 
    %   \draw (br) -- node {$f_{!}$} (bl); 
    %   % vertical lines
    %   \draw (tl) -- node[swap] {$\otimes$} (bl);
    %   \draw (tr) -- node {$(\id_{\rmD(X)},f^{*})$} (mr);
    %   \draw (mr) -- node {$\otimes$} (br); 
    % \end{tikzpicture}\]
  \end{enumerate}
\end{proposition}

\begin{proof}
  (1) follows from \cref{HM24.prop.3.1.8} and the fact that the adjoint is also natural.
  (2) follows from \cref{HM24.prop.3.1.8} by passing to right adjoint functors.
\end{proof}

\subsection{Constructions of 6-functor formalisms}

\begin{definition}[\cite{HM24} Definition 3.3.2] \label{HM24.def.3.3.2}
  Let $(\C,E)$ be a geometric setup.
  We will say that $E$ \textit{has a suitable decomposition} $(I,P)$ if there exists a pair of subclasses of morphisms $(I,P)$ of $E$ satisfying the following conditions:
  \begin{enumerate}
    \item The classes $I$ and $P$ contain all equivalences, and are stable under composition and pullbacks.
    \item Every morphism $f$ in $E$ admits a factorization $f=gj$, where $g$ in $P$ and $j$ in $I$.
    \item For every morphism $f : X \to Y$ in $I$ (resp. $P$), the diagonal $\Delta : X \to X \times_{Y} X$ lies in $I$ (resp. $P$).
    \item Every morphism $f$ in $I \cap P$ is $n$-truncated for some $n \geq -2$ (which may depend on $f$).
  \end{enumerate}
\end{definition}

\begin{remark} \label{rem.equivalent_condition_of_2_of_HM24.def.3.3.2}
  By \cref{HM24.lem.2.1.5}, the condition (2) of \cref{HM24.def.3.3.2} is equivalent to the following condition: 
  The classes $I$ and $P$ are right cancellative in $\C$.
\end{remark}

\begin{definition} \label{def.satisfies_a_suitable_decomposition_condition}
  Let $(\C,E)$ be a geometric setup, and let $\rmD : \C^{\myop} \to \CMon$ be a functor.
  Suppose that $E$ has a suitable decomposition $(I,P)$.
  For every morphism $f : X \to Y$ in $\C$, we denote $f^{*} := \rmD(f) : \rmD(Y) \to \rmD(X)$.
  We will say that $\rmD$ \textit{satisfies a suitable decomposition condition} for $(I,P)$ if it satisfies the following conditions: 
  \begin{enumerate}
    \item For every morphism $j$ in $I$, the functor $j^{*}$ admits a left adjoint functor $j_{!} : \rmD(X) \to \rmD(Y)$, which satisfies proper base change and the projection formula.
    \item For every morphism $g$ in $P$, the functor $g^{*}$ admits a right adjoint functor $g_{*} : \rmD(X) \to \rmD(Y)$, which satisfies the $*$-version base change and the $*$-version projection formula.
    \item For every cartesian diagram in $\C$
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$X'$}; 
      \node (tr) at (1.5,1.5) {$X$};
      \node (bl) at (0,0) {$Y'$}; 
      \node (br) at (1.5,0) {$Y,$}; 
      % horizontal lines
      \draw (tl) -- node {$j'$} (tr); 
      \draw (bl) -- node[swap] {$j$} (br); 
      % vertical lines
      \draw (tl) -- node[swap] {$g'$} (bl);
      \draw (tr) -- node {$g$} (br); 
      % pullback symbol (\lrcorner) in the lower right corner of (tl)
      \node at ([xshift=0.0cm, yshift=-0.2cm] tl.south east) {$\lrcorner$};
    \end{tikzpicture}\]
    where $j$ in $I$ (thus also $j'$ in $I$), and $g$ in $P$ (thus also $g'$ in $P$), the morphism
    \begin{align*}
      j_{!}g'_{*} \to g_{*}j'_{!}
    \end{align*}
    of functors $\rmD(X') \to \rmD(Y)$ is an equivalence.
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$\rmD(X')$}; 
      \node (tr) at (2,1.5) {$\rmD(X)$};
      \node (bl) at (0,0) {$\rmD(Y')$}; 
      \node (br) at (2,0) {$\rmD(Y).$}; 
      % horizontal lines
      \draw (tl) -- node {$j'_{!}$} (tr); 
      \draw (bl) -- node[swap] {$j_{!}$} (br); 
      % vertical lines
      \draw (tl) -- node[swap] {$g'_{*}$} (bl);
      \draw (tr) -- node {$g_{*}$} (br); 
    \end{tikzpicture}\]
  \end{enumerate}
\end{definition}

\begin{remark}
  We impose the condition (3) in \cref{def.satisfies_a_suitable_decomposition_condition} only when the diagram is cartesian. 
  This restriction arises because the morphism $j_{!}g'_{*} \to g_{*}j'_{!}$ is defined using the adjunction:
  \begin{align*}
    \Hom_{\rmD(Y)}(j_{!}g'_{*}(-), g_{*}j'_{!}(-)) 
    &\simeq \Hom_{\rmD(X)}(g^{*}j_{!}g'_{*}(-), j'_{!}(-)) \\
    &\simeq \Hom_{\rmD(X)}(j'_{!}g'^{*}g'_{*}(-), j'_{!}(-)).
  \end{align*}
  Here the second equivalence uses proper base change which is defined only for cartesian diagrams.
  Thus, we cannot \textit{a priori} define a natural equivalence.
  However, we can still deduce the same equivalence as a consequence of the axioms, even when the diagram is not cartesian (\cref{Sch22.const.4.3,Sch22.const.4.4}).
  The following lemmata do not needed to prove \cref{HM24.prop.3.3.3}.
\end{remark}

\begin{lemma}[\cite{Sch22} Construction 4.3] \label{Sch22.const.4.3}
  Let $(\C,E)$ be a geometric setup.
  Suppose that $E$ has a suitable decomposition $(I,P)$.
  Then, for every morphism $f$ in $I \cap P$, there exists a natural equivalence $f_{!} \simeq f_{\ast}$ between the left and right adjoint functors of $f^{*}$.
\end{lemma}

\begin{proof}
  Let $f : X \to Y$ be a morphism in $I \cap P$.
  By (4) of \cref{HM24.def.3.3.2}, $f$ is $n$-truncated for some $n \geq -2$.
  Consider the following diagram.
  \[\begin{tikzpicture}[auto,->] 
    \node (tl) at (0,1.5) {$X \times_{Y} X$}; 
    \node (tr) at (2,1.5) {$X$};
    \node (bl) at (0,0) {$X$}; 
    \node (br) at (2,0) {$Y.$}; 
    \node (univ) at (-1.5,2.5) {$X$};
    % horizontal lines
    \draw (tl) -- node[swap] {$f'$} (tr); 
    \draw (bl) -- node[swap] {$f$} (br); 
    % vertical lines
    \draw (tl) -- node {$f'$} (bl);
    \draw (tr) -- node {$f$} (br); 
    % outer lines (curved)
    \draw (univ) to[bend left=20] node {$\id_{X}$} (tr);
    \draw (univ) to[bend right=30] node[swap] {$\id_{X}$} (bl);
    \draw[dashed] (univ) -- node {$\Delta$} (tl);
    % pullback symbol (\lrcorner) in the lower right corner of (tl)
    \node at ([xshift=-0.2cm, yshift=-0.0cm] tl.south east) {$\lrcorner$};
  \end{tikzpicture}\]
  By (3) of \cref{HM24.def.3.3.2}, the diagonal $\Delta : X \to X \times_{Y} X$ lies in $I \cap P$.
  By (4) of \cref{HM24.def.3.3.2}, $\Delta$ is $n$-truncated for some $n \geq -2$.
  It is well known that, if $f$ is $n$-truncated, then $\Delta$ is $(n-1)$-truncated.

  We prove the statement by induction on $n$.
  
  Base case $(n=-2)$:
  Assume that $f$ is $-2$-truncated, which means $f$ is an equivalence.
  In this case, the left and right adjoint functors of $f^{*}$ coincide.
  Then, we obtain an equivalence $f_{!} \simeq f_{*}$.
  This establishes the base case.

  Inductive step:
  Assume that the statement holds for every $n$-truncated morphisms.
  i.e. for every $n$-truncated morphism $g$, we have $g_{!} \simeq g_{*}$.
  Let $f$ be a $(n+1)$-truncated morphism.
  Then the diagonal $\Delta$ is $n$-truncated.
  By the induction hypothesis, we have an equivalence $\Delta_{!} \simeq \Delta_{*}$.
  Then we have 
  \begin{align*}
    f_{!} 
    \simeq f_{!} {\id_{X}}_{!} 
    \simeq f_{!} {\id_{X}}_{*} 
    \simeq f_{!} g_{*} \Delta_{*} 
    \simeq f_{!} g_{*} \Delta_{!} 
    \simeq f_{*} h_{!} \Delta_{!} 
    \simeq f_{*} {\id_{X}}_{!}
    \simeq f_{*}.
  \end{align*}
\end{proof}

\begin{lemma}[\cite{Sch22} Construction 4.4] \label{Sch22.const.4.4}
  Let $(\C,E)$ be a geometric setup.
  Suppose that $E$ has a suitable decomposition $(I,P)$.
  Then, for every commutative diagram in $\C$
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$X'$}; 
      \node (tr) at (1.5,1.5) {$X$};
      \node (bl) at (0,0) {$Y'$}; 
      \node (br) at (1.5,0) {$Y,$}; 
      % horizontal lines
      \draw (tl) -- node {$j'$} (tr); 
      \draw (bl) -- node[swap] {$j$} (br); 
      % vertical lines
      \draw (tl) -- node[swap] {$g'$} (bl);
      \draw (tr) -- node {$g$} (br); 
      % pullback symbol (\lrcorner) in the lower right corner of (tl)
      \node at ([xshift=0.0cm, yshift=-0.2cm] tl.south east) {$\lrcorner$};
    \end{tikzpicture}\]
    where $j$ in $I$ (thus also $j'$ in $I$), and $g$ in $P$ (thus also $g'$ in $P$), we have an equivalence
    \begin{align*}
      j_{!}g'_{*} \to g_{*}j'_{!}
    \end{align*}
    of functors $\rmD(X') \to \rmD(Y)$.
\end{lemma}

\begin{proof}
  Consider the following diagram.
  \[\begin{tikzpicture}[auto,->] 
    \node (tl) at (0,1.5) {$X \times_{Y} Y'$}; 
    \node (tr) at (2,1.5) {$X$};
    \node (bl) at (0,0) {$Y'$}; 
    \node (br) at (2,0) {$Y.$}; 
    \node (univ) at (-1.5,2.5) {$X'$};
    % horizontal lines
    \draw (tl) -- node[swap] {$j''$} (tr); 
    \draw (bl) -- node[swap] {$j$} (br); 
    % vertical lines
    \draw (tl) -- node {$g''$} (bl);
    \draw (tr) -- node {$g$} (br); 
    % outer lines (curved)
    \draw (univ) to[bend left=20] node {$j'$} (tr);
    \draw (univ) to[bend right=30] node[swap] {$g'$} (bl);
    \draw[dashed] (univ) -- node {$h$} (tl);
    % pullback symbol (\lrcorner) in the lower right corner of (tl)
    \node at ([xshift=-0.2cm, yshift=-0.0cm] tl.south east) {$\lrcorner$};
  \end{tikzpicture}\]
  By \cref{rem.equivalent_condition_of_2_of_HM24.def.3.3.2}, $h$ lies in $I \cap P$.
  By \cref{Sch22.const.4.3}, we obtain an equivalence $h_{!} \simeq h_{*}$.
  Then we have 
  \begin{align*}
    j_{!}g'_{*} 
    \simeq j_{!} g''_{*} h_{*} 
    \simeq j_{!} g''_{*} h_{!} 
    \simeq g_{*}j''_{!} h_{!}
    \simeq g_{*}j'_{!}.
  \end{align*}
\end{proof}

We can also show that if a morphism $f$ in $E$ has two factorizations $f = gj=g'j'$, then the two induced factorizations of $f_{!}$ are equivalent.
It is, of course, the corollary of \cref{HM24.prop.3.3.3}.
To prove this statement (\cref{HM24.prop.3.3.3}), we need the condition (2) of \cref{HM24.def.2.1.1,HM24.rem.2.1.2}.

\begin{proposition}[\cite{Sch22} Construction 4.5] \label{Sch22.const.4.5}
  Let $(\C,E)$ be a geometric setup.
  Suppose that $E$ has a suitable decomposition $(I,P)$.
  Let $f : X \to Y$ be a morphism in $E$ such that there exist two factorizations $f=gj=g'j'$, where $g$ and $g'$ in $P$, and $j$ and $j'$ in $I$.
  Then there exists a natural equivalence 
  \begin{align*}
    g_{*}j_{!} \simeq g'_{*}j_{!}
  \end{align*}
  of functors $\rmD(X) \to \rmD(Y)$.
\end{proposition}

\begin{proof}
  Consider the following diagram.
  \[\begin{tikzpicture}[auto,->] 
    \node (tl) at (0,3) {$X \times_{Y} X$}; 
    \node (tr) at (4,3) {$X$};
    \node (mm) at (2,1.5) {$\overline{X} \times_{Y} \overline{X}'$};
    \node (mr) at (4,1.5) {$\overline{X}$};
    \node (bl) at (0,0) {$X$}; 
    \node (bm) at (2,0) {$\overline{X}'$};
    \node (br) at (4,0) {$Y.$};  
    \node (univ) at (-1.5,4) {$X$};
    % horizontal lines
    \draw (tl) -- node[swap] {$f'$} (tr); 
    \draw (mm) -- node[swap] {$\gamma$} (mr);
    \draw (bl) -- node[swap] {$j'$} (bm); 
    \draw (bm) -- node[swap] {$g'$} (br); 
    % vertical lines
    \draw (tl) -- node {$f'$} (bl);
    \draw (mm) -- node {$\varepsilon$} (bm); 
    \draw (tr) -- node {$j$} (mr);
    \draw (mr) -- node {$g$} (br); 
    % outer lines (curved)
    \draw (univ) to[bend left=20] node {$\id_{X}$} (tr);
    \draw (univ) to[bend right=30] node[swap] {$\id_{X}$} (bl);
    % diagonal lines
    \draw[dashed] (univ) -- node {$\Delta$} (tl);
    \draw[dashed] (tl) -- node {$h'$} (mm);
    % pullback symbol (\lrcorner) in the lower right corner of (tl)
    \node at ([xshift=-0.2cm, yshift=-0.0cm] tl.south east) {$\lrcorner$};
    \node at ([xshift=-0.2cm, yshift=-0.0cm] mm.south east) {$\lrcorner$};
  \end{tikzpicture}\]
  By (2) of \cref{HM24.lem.2.1.5}, the diagonal $\Delta : X \to X \times_{Y} X$ and the induced morphism $h'$ lie in $E$.
  Then the composition $h=h'\Delta$ lies in $E$.
  By (2) of \cref{HM24.def.3.3.2}, $h$ admits a factorization $h=\beta\alpha$, where $\beta$ in $P$ and $\alpha$ in $I$.
  Then we obtain the following diagram.
  \[\begin{tikzpicture}[auto,->] 
    \node (tl) at (0,3.5) {$X$}; 
    \node (tr) at (4,3.5) {$X$};
    \node (mm) at (2,1.5) {$\overline{X} \times_{Y} \overline{X}'$};
    \node (mr) at (4,1.5) {$\overline{X}$};
    \node (bl) at (0,0) {$X$}; 
    \node (bm) at (2,0) {$\overline{X}'$};
    \node (br) at (4,0) {$Y,$};  
    \node (fac) at (1,2.5) {$\overline{X}''$};
    % mark 
    \node (diagram_one) at (3,2.5) {$(1)$};
    \node (diagram_two) at (1,0.75) {$(2)$};
    % horizontal lines
    \draw (tl) -- node {$\id_{X}$} (tr); 
    \draw (mm) -- node {$\gamma$} (mr);
    \draw (bl) -- node[swap] {$j'$} (bm); 
    \draw (bm) -- node[swap] {$g'$} (br); 
    % vertical lines
    \draw (tl) -- node[swap] {$\id_{X}$} (bl);
    \draw (mm) -- node {$\varepsilon$} (bm); 
    \draw (tr) -- node {$j$} (mr);
    \draw (mr) -- node {$g$} (br); 
    % diagonal lines
    \draw (tl) -- node {$\alpha$} (fac);
    \draw (fac) -- node {$\beta$} (mm);
    % pullback symbol (\lrcorner) in the lower right corner of (mm)
    \node at ([xshift=-0.2cm, yshift=-0.0cm] mm.south east) {$\lrcorner$};
  \end{tikzpicture}\]
  where $\alpha$ in $I$, $\beta$, $\gamma$ and $\varepsilon$ in $P$.
  From the diagrams (1) and (2), we get equivalences
  \begin{align*}
    j_{!} \simeq (\gamma\beta)_{*}\alpha_{!}
    \quad \text{ and } \quad 
    j'_{!} \simeq (\varepsilon\beta)_{*}\alpha_{!}.
  \end{align*}
  Then we have 
  \begin{align*}
    g_{*}j_{!} 
    \simeq g_{*} (\gamma\beta)_{*}\alpha_{!}
    \simeq (g\gamma)_{*} \beta_{*}\alpha_{!}
    \simeq (g'\varepsilon)_{*} \beta_{*}\alpha_{!}
    \simeq g'_{*} (\varepsilon\beta)_{*}\alpha_{!}
    \simeq g'_{*}j'_{!}.
  \end{align*}
\end{proof}

\begin{proposition}[\cite{HM24} Proposition 3.3.3] \label{HM24.prop.3.3.3}
  Let $(\C,E)$ be a geometric setup, and let $\rmD : \C^{\myop} \to \CMon$ be a functor. 
  Suppose that $E$ has a suitable decomposition $(I,P)$ and $\rmD$ satisfies a suitable decomposition condition for $(I,P)$.
  Then $\rmD$ can be extended to a 3-functor formalism 
  \begin{align*}
    \rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times},
  \end{align*}
  on $(\C,E)$ such that for every morphism $j$ in $I$, $j_{!}$ is left adjoint to $j^{*}$, and for every morphism $g$ in $P$, $g_{!}$ is right adjoint to $g^{*}$.
\end{proposition}

\begin{corollary}
  Let $(\C,E)$ be a geometric setup, and let $\rmD : \C^{\myop} \to \CMon$ be a functor. 
  In addition to \cref{HM24.prop.3.3.3}, suppose that $\rmD$ satisfies the following conditions:
  \begin{enumerate}
    \item For every object $X$ of $\C$, the symmetric monoidal structure on $\rmD(X)$ is closed.
    \item For every morphism $f : X \to Y$ in $\C$, the functor $f^{*} : \rmD(Y) \to \rmD(X)$ admit a right adjoint functor $f_{*} : \rmD(X) \to \rmD(Y)$.
    \item For every morphism $g : X \to Y$ in $P$, the functor $g_{*}=g_{!} : \rmD(X) \to \rmD(Y)$ admit a right adjoint functor $g^{!} : \rmD(Y) \to \rmD(X)$.
  \end{enumerate}
  Then the 3-functor formalism obtained by \cref{HM24.prop.3.3.3} is a 6-functor formalism on $(\C,E)$. 
\end{corollary}

\subsection{Extensions of 6-functor formalisms}

\begin{definition}
  Let $(\C,E)$ be a geometric setup.
  We will say that $(\C,E)$ is a (\textit{subcanonical}) \textit{site} setup if $\C$ is a (subcanonical) site.
\end{definition}

\begin{definition}[\cite{HM24} Definition 3.4.1] \label{HM24.def.3.4.1}
  Let $(\C,E)$ be a site setup, and let $\rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ be a 3-functor formalism on $(\C,E)$.
  We will say that $\rmD$ is \textit{sheafy} if the induced functor $\rmD^{*} : \C^{\myop} \to \Cat$ (\cref{nota.D_apper_ast}) is a sheaf.
\end{definition}

\begin{proposition}[\cite{HM24} Proposition 3.4.2] \label{HM24.prop.3.4.2}
  Let $(\C,E)$ be a subcanonical site setup, and let $\rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ be a sheafy 3-functor formalism.
  We let $\X:=\Shv(\C)$ denote the topos of sheaves on $\C$.
  We let $E'$ be the collection of morphisms $f' : X \to Y$ in $\X$ such that, for every morphism $g : \yo(Y) \to Y'$ from an object $Y$ of $\C$, the pullback of $f'$ along $g$ lies in $E$.
  Then 
  \begin{enumerate}
    \item The inclusion $\yo : \C \subseteq \X$ induces a morphism of geometric setups $(\C,E) \to (\X,E')$.
    \item There exists a minimal choice of $E'$.
    \item The sheafy 3-functor formalism $\rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ can be uniquely extended to a sheafy 3-functor formalism $\rmD' : \Corr(\X,E')^{\otimes} \to \Cat^{\times}$.
  \end{enumerate}
  Moreover, if $\rmD$ is a presentable sheafy 6-functor formalism, so is $\rmD'$.
\end{proposition}

% \begin{proof}
%   We first show that the pair $(\X,E')$ is a geometric setup (TBA).

%   We next show (1) (TBA).

%   We next show (2) (TBA).

%   We finally show that (3).
%   The inclusion $\yo : \C \subseteq \X$ induces an equivalence of categories $\Shv(\C) \simeq \Shv(\X)$.

% \end{proof}

\begin{theorem}[\cite{HM24} Theorem 3.4.11] \label{HM24.thrm.3.4.11}
  Let $(\C,E)$ be a subcanonical site setup, and let $\rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ be a sheafy presentable 6-functor formalism.
  We let $\X:=\Shv(\C)$ denote the topos of sheaves on $\C$.
  Then there exists a collection of morphisms $E'$ in $\X$ satisfying the following conditions:
  \begin{enumerate}
    \item The inclusion $\yo : \C \subseteq \X$ induces a morphism of geometric setups $(\C,E) \to (\X,E')$.
    \item There exists a minimal choice of $E'$.
    \item The class $E'$ is $*$-local on the target, $!$-local, and tame.
    \item The sheafy presentable 6-functor formalism $\rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$ can be uniquely extended to a sheafy 6-functor formalism $\rmD' : \Corr(\X,E')^{\otimes} \to \Cat^{\times}$.
  \end{enumerate}
\end{theorem}


\section{Other Results}

\subsection{Corollaries of Six-functor Formalisms}

In this section, we show some corollaries of \cref{HM24.prop.3.2.2}.
We fix a geometric setup $(\C,E)$ and a 6-functor formalism $\rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$.

We have the local representation of "Verdier duality".

\begin{corollary} % Ike.thrm.2.3.8
  For every morphism $f : X \to Y$ in $E$, and every pair of objects $F$ of $\rmD(X)$ and $G$ of $\rmD(Y)$, there exists a natural equivalence
  \begin{align*}
    \underline{\Hom}_{\rmD(Y)}(f_{!}F,G) 
    \simeq f_{*}\underline{\Hom}_{\rmD(X)}(F,f^{!}G)
  \end{align*}
  of functors $\rmD(X) \times \rmD(Y) \to \rmD(Y)$.
\end{corollary}

\begin{proof}
  For every object $H$ of $\rmD(X)$, we have 
  \begin{align*}
    \Hom_{\rmD(X)}(H, \underline{\Hom}_{\rmD(Y)}(f_{!}F, G)) 
    &\simeq \Hom_{\rmD(X)}(H \otimes f_{!}F, G) \\ 
    &\simeq \Hom_{\rmD(X)}(f_!(f^{*}H \otimes F), G) \\
    &\simeq \Hom_{\rmD(Y)}(f^{*}H \otimes F, f^{!}G) \\ 
    &\simeq \Hom_{\rmD(Y)}(f^{*}H, \underline{\Hom}_{\rmD(X)}(F, f^{!}G)) \\
    &\simeq \Hom_{\rmD(X)}(H, f_{*}\underline{\Hom}_{\rmD(X)}(F,f^{!}G)).
  \end{align*}
  Here, the second equivalence uses the projection formula.
  The desired assertion follows from Yoneda's lemma.
\end{proof}

\begin{corollary} % Ike.prop.2.3.9
  For every morphism $f : X \to Y$ in $E$, and every pair of objects $F$ and $G$ of $\rmD(Y)$, there exists a natural equivalence
  \begin{align*}
    f^{!}\underline{\Hom}_{\rmD(Y)}(F,G) 
    \simeq \underline{\Hom}_{\rmD(X)}(f^{*}F,f^{!}G)
  \end{align*}
  of functors $\rmD(Y) \times \rmD(Y) \to \rmD(X)$.
\end{corollary}

\begin{proof}
  For every object $H$ of $\rmD(X)$, we have 
  \begin{align*}
    \Hom_{\rmD(X)}(H, f^{!}\underline{\Hom}_{\rmD(Y)}(F,G))
    &\simeq \Hom_{\rmD(Y)}(f_{!}H, \underline{\Hom}_{\rmD(Y)}(F,G)) \\
    &\simeq \Hom_{\rmD(Y)}(f_{!}H \otimes F, G) \\ 
    &\simeq \Hom_{\rmD(Y)}(f_{!}(H \otimes f^{*}F), G) \\
    &\simeq \Hom_{\rmD(X)}(H \otimes f^{*}F, f^{!}G) \\
    &\simeq \Hom_{\rmD(X)}(H, \underline{\Hom}_{\rmD(X)}(f^{*}F, f^{!}G)).
  \end{align*}
  Here, the third equivalence uses the projection formula.
  The desired assertion follows from Yoneda's lemma.
\end{proof}

\begin{corollary} % Ike.prop.2.3.11
  For every morphism $f : X \to Y$ in $E$, there exists a natural morphism 
  \begin{align*}
    f^{!}(-) \otimes f^{*}(-) \to f^{!}(- \otimes -)
  \end{align*}
  from $\rmD(Y) \times \rmD(Y)$ to $\rmD(X)$.
\end{corollary}

\begin{proof}
  For every pair of objects $F$ and $G$ of $\rmD(Y)$, we have 
  \begin{align*}
    \Hom_{\rmD(X)}(f^{!}(F) \otimes f^{*}(G), f^{!}(F \otimes G)) 
    &\simeq \Hom_{\rmD(Y)}(f_{!}(f^{!}(F) \otimes f^{*}(G)), F \otimes G) \\ 
    &\simeq \Hom_{\rmD(Y)}(f_{!}f^{!}F \otimes G, F \otimes G).
  \end{align*}
  Here, the second equivalence uses the projection formula.
  From the unit $f_{!}f^{!}F \to F$ of the adjunction $f_{!} \dashv f^{!}$, we obtain the canonical map 
  \begin{align*}
    f_{!}f^{!}F \otimes G \to F \otimes G.
  \end{align*}
  Then we get a natural morphism 
  \begin{align*}
    f^{!}(F) \otimes f^{*}(G) \to f^{!}(F \otimes G).
  \end{align*}
\end{proof}

\begin{definition}
  Suppose that $\C$ admits finite products.
  Let $X$, $Y$ and $Z$ be objects of $\C$ such that projections $q_{XY}$, $q_{XZ}$ and $q_{YZ}$ from $X \times Y \times Z$ to $X \times Y$, $X \times Z$ and $Y \times Z$ respectively lie in $E$
  \[\begin{tikzpicture}[auto,->]
    \node (bl) at (0,0) {$X \times Y$};
    \node (bm) at (3,0) {$X \times Z$};
    \node (br) at (6,0) {$Y \times Z.$};
    \node (tm) at (3,1.5) {$X \times Y \times Z$};
    \draw (tm) -- node[swap] {$q_{XY}$} (bl);
    \draw (tm) -- node {$q_{XZ}$} (bm);
    \draw (tm) -- node {$q_{YZ}$} (br);
  \end{tikzpicture}\]
  % We will refer to the functor 
  % \begin{align*}
  %   (-) \circ (?)
  %   := {q_{XZ}}_{!}(q_{XY}^{*}(-) \otimes q_{YZ}^{*}(?)) 
  % \end{align*}
  % from $\rmD(X \times Y) \times \rmD(Y \times Z)$ to $\rmD(X \times Z)$ as the \textit{composition functor}.
  For every pair of objects $F_{XY}$ of $\rmD(X \times Y)$ and $F_{YZ}$ of $\rmD(Y \times Z)$, we define the \textit{composition} $F_{XY} \circ F_{YZ}$ of $F_{XY}$ and $F_{YZ}$ on $Y$ by 
  \begin{align*}
    F_{XY} \circ F_{YZ}
    := {q_{XZ}}_{!}(q_{XY}^{*}F_{XY} \otimes q_{YZ}^{*}F_{YZ}).
  \end{align*}
  \[\begin{tikzpicture}[auto,->]
    \node (bl) at (0,0) {$\rmD(X \times Y)$};
    \node (bm) at (3,0) {$\rmD(X \times Z)$};
    \node (br) at (6,0) {$\rmD(Y \times Z).$};
    \node (tm) at (3,1.5) {$\rmD(X \times Y \times Z)$};
    \draw (bl) -- node {$q_{XY}^{*}$} (tm);
    \draw (tm) -- node {${q_{XZ}}_{!}$} (bm);
    \draw (br) -- node[swap] {$q_{YZ}^{*}$} (tm);
  \end{tikzpicture}\]
  Additionally suppose that $\C$ admits a terminal object $\ast$. 
  Consider the case $Z \simeq \ast$.
  % \[\begin{tikzpicture}[auto,->]
  %   \node (bl) at (0,0) {$X \times Y$};
  %   \node (bm) at (3,0) {$X$};
  %   \node (br) at (6,0) {$Y.$};
  %   \node (tm) at (3,1.5) {$X \times Y$};
  %   \draw (tm) -- node[swap] {$\id_{XY}$} (bl);
  %   \draw (tm) -- node {$q_{X}$} (bm);
  %   \draw (tm) -- node {$q_{Y}$} (br);
  % \end{tikzpicture}\]
  For every pair of objects $K$ of $\rmD(X \times Y)$ and $F$ of $\rmD(Y)$, we will refer to the composition 
  \begin{align*}
    K \circ F
    \simeq {q_{X}}_{!}(K \otimes q_{Y}^{*}F) 
  \end{align*}
  as the \textit{integral transformation} of $F$ by $K$. 
\end{definition}

Note that the composition (especially the integral transformation) can be defined in the setting of 3-functor formalisms $\rmD$.
However, there exists the right adjoint functor to it if $\rmD$ is a 6-functor formalism.

\begin{corollary} % Ike.p90
  Suppose that $\C$ admits finite products and a terminal object.
  Let $K$ be an object of $\rmD(X \times Y)$.
  Then the integral transformation $K \circ - : \rmD(Y) \to \rmD(X)$ admits a right adjoint functor.
\end{corollary}

\begin{proof}
  Let $F$ be an object of $\rmD(Y)$ and let $G$ be an object of $\rmD(X)$, we have 
  \begin{align*}
    \Hom_{\rmD(X)}({q_{X}}_{!}(K \otimes q_{Y}^{*}F), G)
    &\simeq \Hom_{\rmD(X \times Y)}(K \otimes q_{Y}^{*}F, q_{X}^{!}G) \\
    &\simeq \Hom_{\rmD(X \times Y)}(q_{Y}^{*}F, \underline{\Hom}_{\rmD(X \times Y)}(K, q_{X}^{!}G)) \\
    &\simeq \Hom_{\rmD(Y)}(F, {q_{Y}}_{*}\underline{\Hom}_{\rmD(X \times Y)}(K, q_{X}^{!}G)).
  \end{align*}
  Then the functor 
  \begin{align*}
    {q_{Y}}_{*}\underline{\Hom}_{\rmD(X \times Y)}(K, q_{X}^{!}(-)) : \rmD(X) \to \rmD(Y)
  \end{align*}
  is right adjoint to the integral transformation.
\end{proof}

\subsection{Sheaf Cohomology and K\"{u}nneth Formula}

We fix a geometric setup $(\C,E)$ and a 3-functor formalism $\rmD : \Corr(\C,E)^{\otimes} \to \Cat^{\times}$.
Suppose that $\C$ admits a terminal object $\ast$.

\begin{definition}
  Let $X$ be an object of $\C$, and let $p_{X} : X \to *$ be the projection.
  % We denote the unit object of $\rmD(X)$ by $\mathbbl{1}_{X}$.
  For an object $F$ of $\rmD(X)$, we define the \textit{cohomology $\Gamma(X;F)$ of $X$ with coefficient in $F$} by
  \begin{align*}
    \Gamma(X;F)
    := {p_{X}}_{*}F.
  \end{align*}
  % In particular, for the unit object $\mathbbl{1}_{X}$ of $\rmD(X)$, we denote the cohomology by 
  % \begin{align*}
  %   \Gamma(X;\ast) 
  %    {p_{X}}_{*}\mathbbl{1}_{X} \in \rmD(\ast).
  % \end{align*}
  Suppose that the projection $p_{X}$ lies in $E$.
  Similarly, we define the \textit{cohomology with compact support $\Gamma_{c}(X;\ast)$ of $X$ with coefficient in $F$} by 
  \begin{align*}
    \Gamma_{c}(X;F)
    := {p_{X}}_{!}F.
  \end{align*}
  % \begin{align*}
  %   \Gamma_{c}(X;\ast)
  %   := {p_{X}}_{!}\mathbbl{1}_{X} \in \rmD(*).
  % \end{align*}
\end{definition}

We prove the important result on cohomology: K\"{u}nneth Formula.

\begin{proposition}[K\"{u}nneth Formula]
  Let $X$ and $Y$ be objects of $\C$ such that projections $p_{X}$ and $p_{Y}$ lie in $E$.
  For every pair of objects $F$ of $\rmD(X)$ and $G$ of $\rmD(Y)$, there exists an equivalence in $D(*)$
  \begin{align*}
    \Gamma_{c}(X \times Y;q_{X}^{*}F \otimes q_{Y}^{*}G)
    \simeq \Gamma_{c}(X;F) \otimes \Gamma_{c}(Y;G).
  \end{align*}
\end{proposition}

\begin{proof}
  Consider the following diagram.
  \[\begin{tikzpicture}[auto,->] 
    \node (tl) at (0,1.5) {$X \times Y$}; 
    \node (tr) at (2.5,1.5) {$Y$};
    \node (bl) at (0,0) {$X$}; 
    \node (br) at (2.5,0) {$*.$}; 
    % horizontal lines
    \draw (tl) -- node {$q_{Y}$} (tr); 
    \draw (bl) -- node[swap] {$p_{X}$} (br); 
    % vertical lines
    \draw (tl) -- node[swap] {$q_{X}$} (bl);
    \draw (tr) -- node {$p_{Y}$} (br); 
    % diagonal 
    \draw (tl) -- node {$p_{X \times Y}$} (br);
  \end{tikzpicture}\]
  Then $p_{X}, p_{Y}, q_{X}, q_{Y}$ and $p_{X \times Y}$ lie in $E$, since $E$ is closed under pullbacks and composition.
  We have
  \begin{align*}
    \Gamma_{c}(X \times Y;q_{X}^{*}F \otimes q_{Y}^{*}G)
    &\simeq {p_{X \times Y}}_{!}(q_{X}^{*}F \otimes q_{Y}^{*}G) \\
    &\simeq {p_{X}}_{!}{q_{X}}_{!}(q_{X}^{*}F \otimes q_{Y}^{*}G) \\
    &\simeq {p_{Y}}_{!}(F \otimes {q_{X}}_{!}q_{Y}^{*}G) \\
    &\simeq {p_{Y}}_{!}(F \otimes p_{X}^{*}{p_{Y}}_{!}G) \\
    &\simeq {p_{X}}_{!}F \otimes {p_{Y}}_{!}G \\
    &\simeq \Gamma_{c}(X;F) \otimes \Gamma_{c}(Y;G).
  \end{align*}
  Here, the third and fifth equivalences use the projection formula, and the third uses proper base change.
\end{proof}

We can prove it as the proof of \cref{HM24.prop.3.1.8}.

\begin{proof}
  Consider the following diagram.
  \[\begin{tikzpicture}[auto,->] 
    \node (tl) at (0,1.5) {$X \times Y$}; 
    \node (tr) at (3,1.5) {$*$};
    \node (bl) at (0,0) {$(X \times Y)^2$}; 
    \node (br) at (3,0) {$X \times Y.$}; 
    % horizontal lines
    \draw (tl) -- node {$p_{X \times Y}$} (tr); 
    \draw (bl) -- node[swap] {$(q_{X},q_{Y})$} (br); 
    % vertical lines
    \draw (tl) -- node[swap] {$\Delta_{X \times Y}$} (bl);
    \draw (br) -- node[swap] {$p_{X \times Y}$} (tr); 
  \end{tikzpicture}\]
  Then $p_{X}, p_{Y}, q_{X}, q_{Y}$ and $p_{X \times Y}$ lie in $E$.

  The morphism $X \times Y \xrightarrow{p_{X \times Y}} *$ in $E$ determines a correspondence
  \[\begin{tikzpicture}[auto]
    \node (11) at (0,3) {$X \times Y$};
    \node (12) at (2,3) {$X \times Y$};
    \node (13) at (4,3) {$X \times Y$};
    \node (22) at (2,1.5) {$* \times *$};
    \node (23) at (4,1.5) {$*$};
    \node (33) at (4,0) {$*.$};
    % horizontal lines
    \draw[transform canvas={yshift=1.5pt}] (12) -- (11);
    \draw[transform canvas={yshift=-1.5pt}] (12) -- (11);   
    \draw[transform canvas={yshift=1.5pt}] (13) -- (12);
    \draw[transform canvas={yshift=-1.5pt}] (13) -- (12);   
    \draw[->] (23) -- node[swap] {$\Delta_{*}$} (22);
    % vertical lines
    \draw[->] (12) -- node {$(p_{X},p_{Y})$} (22);
    \draw[->] (13) -- node {$p_{X \times Y}$} (23);
    \draw[transform canvas={xshift=1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=-1.5pt}] (23) -- (33);
    % pullback symbol
    \node at (3.6,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
  \end{tikzpicture}\]
  The morphism $X \xrightarrow{\Delta_{X \times Y}} (X \times Y)^2 \xrightarrow{(q_{X},q_{Y})} X \times Y \xrightarrow{(p_{X},p_{Y})} * \times * \simeq *$ determines a correspondence
  \[\begin{tikzpicture}[auto]
    \node (11) at (-1.5,4.5) {$X \times Y$};
    \node (12) at (1,4.5) {$(X \times Y)^2$};
    \node (13) at (4,4.5) {$X \times Y$};
    \node (14) at (6,4.5) {$X \times Y$};
    \node (22) at (1.0,3) {$(X \times Y)^2$};
    \node (23) at (4,3) {$X \times Y$};
    \node (24) at (6,3) {$X \times Y$};
    \node (33) at (4,1.5) {$X \times Y$};
    \node (34) at (6,1.5) {$X \times Y$};
    \node (44) at (6,0) {$*.$};
    % horizontal lines
    \draw[->] (12) -- node[swap] {$(q_{X},q_{Y})$} (11);
    \draw[->] (13) -- node[swap] {$\Delta_{X \times Y}$} (12);
    \draw[transform canvas={yshift=1.5pt}] (14) -- (13);
    \draw[transform canvas={yshift=-1.5pt}] (14) -- (13);   
    \draw[->] (23) -- node[swap] {$\Delta_{X \times Y}$} (22);
    \draw[transform canvas={yshift=1.5pt}] (24) -- (23);
    \draw[transform canvas={yshift=-1.5pt}] (24) -- (23);  
    \draw[transform canvas={yshift=1.5pt}] (34) -- (33);
    \draw[transform canvas={yshift=-1.5pt}] (34) -- (33);  
    % vertical lines
    \draw[transform canvas={xshift=1.5pt}] (12) -- (22);
    \draw[transform canvas={xshift=-1.5pt}] (12) -- (22);
    \draw[transform canvas={xshift=1.5pt}] (13) -- (23);
    \draw[transform canvas={xshift=-1.5pt}] (13) -- (23);
    \draw[transform canvas={xshift=1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=-1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=1.5pt}] (14) -- (24);
    \draw[transform canvas={xshift=-1.5pt}] (14) -- (24);
    \draw[transform canvas={xshift=1.5pt}] (24) -- (34);
    \draw[transform canvas={xshift=-1.5pt}] (24) -- (34);
    \draw[transform canvas={xshift=1.5pt}] (34) -- (34);
    \draw[transform canvas={xshift=-1.5pt}] (34) -- (34);
    \draw[->] (34) -- node {$p_{X \times Y}$} (44);
    % pullback symbol
    \node at (3.6,4.1) {\rotatebox[origin=c]{90}{$\ulcorner$}};
    \node at (5.6,4.1) {\rotatebox[origin=c]{90}{$\ulcorner$}};
    \node at (5.6,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
  \end{tikzpicture}\]
  The first correspondence defines a functor 
  \begin{align*}
    &\rmD(X) \times \rmD(Y) \to * \times * \to * \\
    &(F,G) \mapsto ({p_{X}}_{!}F, {p_{Y}}_{!}G) \mapsto {p_{X}}_{!}F \otimes {p_{Y}}_{!}G \simeq \Gamma_{c}(X;F) \otimes \Gamma_{c}(Y;G).
  \end{align*}
  The second correspondence defines a functor 
  \begin{align*}
    &\rmD(X) \times \rmD(Y) \to (\rmD(X) \times \rmD(Y))^2 \to \rmD(X) \times \rmD(Y) \to D(\ast) \\
    &(F,G) \mapsto (q_{X}^{*}F, q_{Y}^{*}G) \mapsto q_{X}^{*}F \otimes q_{Y}^{*}G \mapsto {p_{X \times Y}}_{!} q_{X}^{*}F \otimes q_{Y}^{*}G \simeq \Gamma_{c}(X \times Y;q_{X}^{*}F \otimes q_{Y}^{*}G).
  \end{align*}
  This implies that a morphism $\Gamma_{c}(X \times Y;q_{X}^{*}F \otimes q_{Y}^{*}G) \to \Gamma_{c}(X;F) \otimes \Gamma_{c}(Y;G)$ is a natural equivalence in $\rmD(Y)$, since $\rmD$ is a functor.
\end{proof}

% \begin{proposition}[K\"{u}nneth Formula]
%   Let $X$ and $Y$ be objects of $\C$.
%   Then there exists an equivalence in $D(*)$
%   \begin{align*}
%     \Gamma_{c}(X \times Y;\ast)
%     \simeq \Gamma_{c}(X;\ast) \otimes \Gamma_{c}(Y;\ast).
%   \end{align*}
% \end{proposition}

% \begin{proof}
%   Consider the following diagram.
%   \[\begin{tikzpicture}[auto,->] 
%     \node (tl) at (0,1.5) {$X \times Y$}; 
%     \node (tr) at (2.5,1.5) {$Y$};
%     \node (bl) at (0,0) {$X$}; 
%     \node (br) at (2.5,0) {$\ast$}; 
%     % horizontal lines
%     \draw (tl) -- node {$q_{Y}$} (tr); 
%     \draw (bl) -- node[swap] {$p_{X}$} (br); 
%     % vertical lines
%     \draw (tl) -- node[swap] {$q_{X}$} (bl);
%     \draw (tr) -- node {$p_{Y}$} (br); 
%     % diagonal 
%     \draw (tl) -- node {$p_{X \times Y}$} (br);
%   \end{tikzpicture}\]
%   We have 
%   \begin{align*}
%     \Gamma_{c}(X \times Y;\ast)
%     &\simeq {p_{X \times Y}}_{!}\mathbbl{1}_{X \times Y} \\
%     &\simeq {p_{Y}}_{!}{q_{Y}}_{!}\mathbbl{1}_{X \times Y} \\
%     &\simeq {p_{Y}}_{!}{q_{Y}}_{!}(q_{X}^{*}\mathbbl{1}_{X} \otimes q_{Y}^{*}\mathbbl{1}_{Y}) \\
%     &\simeq {p_{Y}}_{!}(\mathbbl{1}_{Y} \otimes {q_{Y}}_{!}q_{X}^{*}\mathbbl{1}_{X}) \\
%     &\simeq {p_{Y}}_{!}(\mathbbl{1}_{Y} \otimes p_{Y}^{*}{p_{X}}_{!}\mathbbl{1}_{X}) \\
%     &\simeq {p_{X}}_{!}\mathbbl{1}_{X} \otimes {p_{Y}}_{!}\mathbbl{1}_{Y} \\
%     &\simeq \Gamma_{c}(X;\ast) \otimes \Gamma_{c}(Y;\ast).
%   \end{align*}
% \end{proof}



\newpage
\appendix


\section{Derived Categories and Derived Functors} \label{sec.derived_categories}

\subsection{Derived Categories and Derived Functors}

We recall the classical notions of derived categories and (right) derived functors.

\begin{notation}
  Let $\A$ be an abelian category.
  We let
  \begin{itemize}
    \item $C(\A)$ denote the category of complexes of $\A$.
    \item $K(\A)$ denote the homotopy category of complexes of $\A$.
    \item $D(\A)$ denote the derived category of complexes of $\A$.
    % \item $D(\A)$ denote the localization of $K(\A)$ with respect to the set of quasi-isomorphisms, refer to it as the \textit{derived category} of $\A$.
  \end{itemize}
  Let $F : \A \to \B$ be a functor between abelian categories.
  We also denote by $F : K(\A) \to K(\B)$ the induced functor between homotopy categories.
\end{notation}

Let $\A$ and $\B$ be abelian categories.
If a functor $F : K(\A) \to K(\B)$ between homotopy categories is exact, then it preserves quasi-isomorphisms.
In this case, it induces a functor $F : D(\A) \to D(\B)$ between derived categories.
However, in general, it does not necessarily preserves quasi-isomorphisms.
That is, it does not send objects which are isomorphic in $D(\A)$ to objects which are isomorphic in $D(\B)$.
To avoid this issue, we consider derived functors.

\begin{definition}
  Let $F : \A \to \B$ be a left exact functor between abelian categories.
  A \textit{right derived functor} $(\bbR F,\tau)$ is the left Kan extension of $Q_{\B}F$ along $Q_{\A}$.
  \[\begin{tikzpicture}[auto,->] 
    \node (tl) at (0,1.5) {$D(\A)$}; 
    \node (bl) at (0,0) {$K(\A)$}; 
    \node (bm) at (2,0) {$K(\B)$};
    \node (br) at (4,0) {$D(\B)$}; 
    % horizontal line 
    \draw (bl) -- node[swap] {$F$} (bm); 
    \draw (bm) -- node[swap] {$Q_{\B}$} (br);
    % vertical line
    \draw (bl) -- node {$Q_{\A}$} (tl);
    % from tl to br
    \draw (tl) -- node {$\bbR F$} (br); 
    \draw (1,0.2) -- node {$\tau$} (1.5,0.8);
  \end{tikzpicture}\]
\end{definition}

We consider the conditions under which derived functors exist.

\begin{definition} \label{Ike.2.1.26}
  Let $F : \A \to \B$ be a left exact functor between abelian categories, and let $\I$ be an additive full subcategory of $\A$.
  We will say that $\I$ is \textit{$F$-injective} if it satisfies the following conditions:
  \begin{enumerate}
    \item For every object $A$ of $\A$, there exist an object $I$ of $\I$ and a monomorphism $A \to I$.
    \item Let $0 \to A \to B \to C \to 0$ is a short exact sequence in $\A$. 
    If $A$ and $B$ are in $\I$, then $C$ is also in $\I$.
    \item Let $0 \to A \to B \to C \to 0$ is a short exact sequence in $\A$.
    If $A$ is in $\I$, then $0 \to F(A) \to F(B) \to F(C) \to 0$ is a short exact sequence in $\B$.
  \end{enumerate}
\end{definition}

\begin{proposition} \label{Ike.2.1.28}
  Let $F : \A \to \B$ be a left exact functor between abelian categories.
  Suppose that there exists an $F$-injective additive full subcategory $\I$ of $\A$.
  Then there exists the right derived functor $\bbR F : D(\A) \to D(\B)$ of $F$.
  Moreover, $\bbR F$ preserves quasi-isomorphisms.
\end{proposition}

\begin{remark} \label{Ike.2.1.30}
  Let $F : \A \to \B$ be a left exact functor between abelian categories.
  If $\A$ has enough injectives, then the additive full subcategory spanned by injective objects of $\A$ is $F$-injective.
  Moreover, there exists the right derived functor $\bbR F : D(\A) \to D(\B)$ of $F$.
\end{remark}

We consider when the derived functor of a composition of two functors is itself a derived functor.

\begin{proposition} \label{Ike.2.1.31}
  Let $F : \A \to \B$ and $G : \B \to \C$ be left exact functors between abelian categories.
  Suppose that there exist an $F$-injective additive full subcategory $\I_{\A}$ of $\A$ and a $G$-injective additive full subcategory $\I_{\B}$ of $\B$ which satisfy $F(\I_{\A}) \subseteq \I_{\B}$.
  Then $\I_{\A}$ is $GF$-injective and there exists a natural isomorphism $\bbR(G \circ F) \simeq \bbR G \circ \bbR F$.
\end{proposition}

We consider the derived category of sheaves and the right derived functor of the global section functor.

\begin{notation} \label{Ike.2.2.2}
  Let $X$ be a topological space.
  We let $D(X)$ denote the derived category of sheaves on $X$.
\end{notation}

\begin{example} 
  Let $X$ be a topological space, and let $\Gamma(X;-) : \Shv(X) \to \Ab$ be the global section functor.
  Then an additive full subcategory of $\Shv(X)$ spanned by flabby sheaves is $\Gamma(X;-)$-injective.
  Thus there exists the right derived functor 
  \begin{align*}
    \bbR \Gamma(X;-) : D(X) \to D(\Ab).
  \end{align*}
  of the global section functor $\Gamma(X;-) : \Shv(X) \to \Ab$.
\end{example}

% In the rest of this section, we discuss the right derived functor of hom functor.

\subsection{Flabby, C-soft, and Flat Sheaves}

In this section, we recall the notions of flabby, c-soft, and flat sheaves.

\begin{definition} \label{Ike.1.2.1}
  Let $X$ be a topological space.
  A sheaf $F$ on $X$ is called \textit{flabby} (or \textit{flasque}) if, for every open subset $U$ of $X$, a morphism $F(X) \to F(U)$ is surjective.
\end{definition}

\begin{proposition}
  Let $X$ be a topological space.
  Then for every sheaf $F$ on $X$, there exist a flabby sheaf $[F]$ and a mono morphism $F \to [F]$.
\end{proposition}

\begin{proposition}
  Let $0 \to F \to G \to H \to 0$ be an exact sequence of sheaves.
  If $F$ is flabby, then the global section functor $\Gamma(X;F) : \Shv(X) \to \Ab$ is exact.
  Moreover, if $F$ and $G$ are flabby, then so is $H$.  
\end{proposition}

\begin{definition} \label{Ike.2.2.12}
  Let $X$ be a topological space.
  A sheaf $F$ on $X$ is called \textit{c-soft} if, for every compact subset $K$ of $X$, a morphism $\Gamma(X;F) \to \Gamma(K,F_{K})$ is surjective.
\end{definition}

\begin{proposition}
  Let $f : X \to Y$ be a continuous map of locally compact Hausdorff spaces.
  Then the full subcategory of $\Shv(X)$ spanned by c-soft sheaves is $f_{!}$-injective.
\end{proposition}

\begin{definition} \label{Ike.2.2.4}
  Let $X$ be a topological space.
  A sheaf $F$ on $X$ is called \textit{flat} if the tensor product functor $F \otimes - : \Shv(X) \to \Shv(X)$ is exact.
\end{definition}

\begin{proposition}
  Let $X$ be a topological space.
  Then for every sheaf $F$ on $X$, there exist a flat sheaf $P$ and an epimorphism $P \to F$.
\end{proposition}

\printbibliography


\end{document}

\subsection{Sheaf Cohomology}

\begin{definition}
  Let $\A$ be an abelian category which has enough injectives, and let $F : \A \to \B$ be a left exact functor between abelian categories.
  For every object $A$ of $\A$, we take an injective resolution $0 \to A \to I_A$.
  Then we obtain a complex in $\B$ by applying $F$ to the complex $I_A$
  \begin{align*}
    F(I_A) : F(I_A^0) \xrightarrow{T(d^0)} F(I_A^1) \xrightarrow{T(d^1)} F(I_A^2) \xrightarrow{T(d^2)} \cdots.
  \end{align*}
  We define 
  \begin{align*}
    R^nF(A) := H^n F(I_A) := \Ker F(d^n) / \Im F(d^{n-1}),
  \end{align*}
  which induces a functor 
  \begin{align*}
    R^nF : \A \to \B,
  \end{align*}
  since the construction $A \mapsto H^nF(I_A)$ is functional on $A$.
  We will refer to it as the \textit{$n$-th right derived functor} of $F$.
\end{definition}

We apply the $n$-th right derived functor for the global section functor.

\begin{example}
  Let $X$ be a topological space, and let $\Gamma(X;-) : \Shv(X) \to \Ab$ be the global section functor.
  Then the \textit{$n$-th sheaf cohomology} 
  \begin{align*}
    H^n(X;-) : \Shv(X) \to \Ab
  \end{align*}
  is defined as the $n$-th right derived functor $R^n \Gamma(X;-)$ of $\Gamma(X;-)$.
\end{example}

By construction, we have 
\begin{align*}
  H^n \circ \bbR \Gamma(X;-) = H^n(X;-).
\end{align*}
This implies that sheaf cohomology can be lifted to a functor between derived categories.
\[\begin{tikzpicture}[auto,->] 
  \node (tl) at (0,1.5) {$D(X)$}; 
  \node (bl) at (0,0) {$K(\Shv(X))$}; 
  \node (bm) at (3,0) {$K(\Ab)$};
  \node (br) at (5,0) {$D(\Ab)$}; 
  \node (brr) at (7,0) {$\Ab$};
  % horizontal line 
  \draw (bl) -- node[swap] {$\Gamma(X;-)$} (bm); 
  \draw (bm) -- node[swap] {$Q_{\B}$} (br);
  \draw (br) -- node[swap] {$H^n$} (brr);
  % vertical line
  \draw (bl) -- node {$Q_{\A}$} (tl);
  % from tl to br/brr
  \draw (tl) -- node {$\bbR \Gamma(X;-)$} (br); 
  \draw (tl) to[bend left=20] node[pos=0.8] {$H^n(X;-)=R^n\Gamma(X;-)$} (brr); 
\end{tikzpicture}\]

We show (3).
We consider the map $X \xrightarrow{h} Y'$ given by the correspondence
\[\begin{tikzpicture}[auto,->]
  \node (11) at (0,3) {$X$};
  \node (12) at (1.5,3) {$X'$};
  \node (22) at (1.5,1.5) {$Y'.$};
  % horizontal lines
  \draw (12) -- node[swap] {$g'$} (11);
  % vertical lines
  \draw (12) -- node {$f'$} (22);
\end{tikzpicture}\]
We obtain its factorization as follows:
The map $X \xrightarrow{h_1} Y \xrightarrow{h_2} Y'$ which is given be the correspondence
\[\begin{tikzpicture}[auto]
  \node (11) at (0,3) {$X$};
  \node (12) at (1.5,3) {$X$};
  \node (13) at (3,3) {$X'$};
  \node (22) at (1.5,1.5) {$Y$};
  \node (23) at (3,1.5) {$Y'$};
  \node (33) at (3,0) {$Y'.$};
  % horizontal lines
  \draw[transform canvas={yshift=1.5pt}] (12) -- (11);
  \draw[transform canvas={yshift=-1.5pt}] (12) -- (11);
  \draw[->] (13) -- node[swap] {$g'$} (12);
  \draw[->] (23) -- node[swap] {$g$} (22);
  % vertical lines
  \draw[->] (12) -- node {$f$} (22);
  \draw[->] (13) -- node {$f'$} (23);
  \draw[transform canvas={xshift=1.5pt}] (23) -- (33);
  \draw[transform canvas={xshift=-1.5pt}] (23) -- (33);
  % pullback symbol
  \node at (2.6,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
\end{tikzpicture}\]
The map $X \xrightarrow{h} Y'$ defines a functor 
\begin{align*}
  D(h) : D(X) \xrightarrow{g'^{*}} D(X') \xrightarrow{f'_{!}} D(Y').
\end{align*}
The factorization $X \xrightarrow{h_1} Y \xrightarrow{h_2} Y'$ defines a functor 
\begin{align*}
  D(h_2h_1) : (X) \xrightarrow{f_{!}} D(X') \xrightarrow{g^{*}} D(Y').
\end{align*}
We obtain a natural equivalence $g^{*}f_{!} \simeq f'_{!}g'^{*}$, since $D$ is a functor (thus we have an equivalence $D(h_2h_1) \simeq D(h)$).

\section{6-functor formalisms} \label{sec.six_functors_formalisms}

From here all categories are assumed to be $\infty$-categories.
In this section, we introduce Mann's definition of 6-functor formalisms, considering the following setup:
\begin{itemize}
  \item A category $\C$ of the "geometric objects."
  \item A class $E$ of morphisms in $\C$, where the exceptional functors $f_{!}$ and $f^{!}$ can be defined.
\end{itemize}
For example, this could be the category of sheaves, with the class of morphisms which have finite cohomology dimension.
We assume the following hypothesis (motivated by the above example):
\begin{itemize}
  \item The category $\C$ admits finite limits.
  \item The class $E$ contains all equivalences, and is stable under composition and pullbacks.
\end{itemize}
We expect a 6-functor formalism $D$ to satisfy the following conditions (see results in \cref{subsec.remarkable_results}):
\begin{enumerate}
  \item $D$ assigns each object $X$ of $\C$ to a category $D(X)$.
  \item For every object $X$ of $\C$, $D(X)$ is equipped with a symmetric monoidal structure $\otimes$ (\cref{thrm.symmetric_monoidality}).
  \item For every morphism $f : X \to Y$ in $\C$, there is an inverse functor $f^{*} : D(Y) \to D(X)$ which is compatible with composition in $\C$ and with the symmetric monoidal structure (\cref{thrm.symmetric_monoidality,thrm.naturality}).
  \item For every morphism $f : X \to Y$ in $E$, there is an exceptional inverse functor $f_{!} : D(X) \to D(Y)$ which is compatible with composition in $\C$ and satisfies the proper base change theorem and projection formula (\cref{thrm.naturality,thrm.proper_base_change,thrm.projection_formula}).
  \item The functors $\otimes, f^{*}$ and $f_{!}$ admit right adjoint functors $\underline{\Hom}, f_{*}$ and $f^{!}$.
\end{enumerate}
Since there are two morphisms in opposite directions, $f^{*} : D(Y) \to D(X)$ and $f_{!} : D(X) \to D(Y)$, associated with a morphism $f : X \to Y$, it is necessary to define a new category which contains both categories $\C^{\myop}$ and $\C_{E}$.
This new category can be constructed using the \textit{category of correspondences}, denoted $\Corr(\C,E)$.
 
With this setup, conditions (1)-(3) can be encoded by a lax symmetric monoidal functor 
\begin{align*}
  \Corr(\C,E) \to \CMon(\Cat),
\end{align*}
where $\CMon(\Cat)$ is the category of symmetric monoidal categories with symmetric monoidal functors.
Condition (5) is simply a requirement that will be satisfied.
The most difficult part is encoding condition (4).

\subsection{Definitions} \label{subsec.six_functors_formalisms}

In this section, we introduce Mann's definition of 6-functor formalisms.
The goal of this section is show the proper base change theorem and projection formula in this setting (\cref{Mann.prop.A.5.8}). 
We first define the geometric setup and give some examples.

\begin{definition}[\cite{Mann22} Definition A.5.1] \label{Mann.def.A.5.1}
  A \textit{geometric setup} $(\C,E)$ consists of the following data:
  \begin{itemize}
    \item A category $\C$ which admits finite limits.
    \footnote{
      In \cite{Mann22}, this condition is not required. 
      However, in many cases, $\C$ satisfies this condition.
      We follow from \cite{Sch22}.
    }
    \item A class $E$ of morphisms in $\C$ which contains all equivalences, and is stable under composition and pullbacks along morphisms in $\C$.
    \footnote{
      In \cite{HM24}, the additional condition is required: 
      for every morphism $X \to Y$ in $E$, the diagonal $X \to X \times_{Y} X$ lies in $E$.
      It is equivalent to the following condition:
      the inclusion $\C_{E} \subseteq \C$ preserves fiber products (\cite{HM24} Lemma 2.1.5).
      This condition is not essential in this note. 
      See \cite{HM24} Remark 2.1.2.
    }
  \end{itemize}
\end{definition}

\begin{notation}
  Let $(\C,E)$ be a geometric setup.
  We let $\C_{E}$ denote the subcategory of $\C$ consisting of the morphisms in $E$.
\end{notation}

\begin{example}
  Let $\C$ be a category which admits finite limits.
  \begin{enumerate}
    \item The pair $(\C,\C)$ is a trivial geometric setup.
    \item The pair $(\C,\core\C)$ is a geometric setup, where $\core\C$ is the underlying anima of $\C$.
    \item If a pair $(\C,E)$ is a geometric setup, then so is the pair $(E,E)$. 
  \end{enumerate}
\end{example}

\begin{definition}[\cite{HA} Construction 5.2.1.1]
  Let $\C$ be a category.
  The \textit{twisted arrow category} $\TwAr(\C)$ of $\C$ is the simplicial set which is defined by 
  \begin{align*}
    \TwAr(\C)_n := \Hom_{\mathrm{sSet}}([n] \star [n]^{\myop},\C)
  \end{align*}
  for every $n \geq 0$, where $\star$ is the join operator.
  By \cite{HA} Proposition 5.2.1.3, $\TwAr(\C)$ is a category.
  A morphism of $\TwAr(\C)$ is called \textit{vertical} (resp. \textit{horizontal}) if its projection to the second (resp. first) factor is degenerate.
\end{definition}

\begin{definition}[\cite{Mann22} Definition A.5.2] \label{Mann.def.A.5.2}
  Let $(\C,E)$ be a geometric setup.
  The \textit{category of correspondences} $\Corr(\C,E)$ is the simplicial set where the $n$-simplices are the functors $X : \TwAr([n]) \to \C$ which satisfy the following conditions:
  \begin{enumerate}
    \item The functor $X$ sends every vertical edge in $\TwAr([n])$ to $E$.
    \item  The functor $X$ sends every biCartesian diagram in $\TwAr([n])$ to a Cartesian diagram in $\C$.
  \end{enumerate}
  By \cite{LZ17} Lemma 6.1.2, $\Corr(\C,E)$ is a category.
\end{definition}

\begin{remark}
  Let $(\C,E)$ be a geometric setup.
  Then the lower simplices of $\Corr(\C,E)$ can be described as follows:
  \begin{itemize}
    \item The objects of $\Corr(\C,E)$ are the objects of $\C$.
    \item A morphism $X \to Y$ in $\Corr(\C,E)$ is given by the following diagram in $\C$
    \[\begin{tikzpicture}[auto,->]
      \node (11) at (0,3) {$X$};
      \node (12) at (1.5,3) {$X'$};
      \node (22) at (1.5,1.5) {$Y,$};
      % horizontal lines
      \draw (12) -- node[swap] {$h$} (11);
      % vertical lines
      \draw (12) -- node {$v$} (22);
    \end{tikzpicture}\]
    where $X'$ is an object of $\C$ and $v$ is a morphism in $E$.
    \item A composition of morphisms $X \to Y$ and $Y \to Z$ in $\Corr(\C,E)$ represented by diagrams $X \xleftarrow{h_1} X' \xrightarrow{v_1} Y$ and $Y \xleftarrow{h_2} Y' \xrightarrow{v_2} Z$ in $\C$ respectively, is given by the following diagram in $\C$.
    \[\begin{tikzpicture}[auto,->]
      \node (11) at (0,3) {$X$};
      \node (12) at (1.5,3) {$X'$};
      \node (13) at (3.5,3) {$X \times_{Y} Y'$};
      \node (22) at (1.5,1.5) {$Y$};
      \node (23) at (3.5,1.5) {$Y'$};
      \node (33) at (3.5,0) {$Z.$};
      % horizontal lines
      \draw (12) -- node[swap] {$h_1$} (11);
      \draw (13) -- node[swap] {} (12);
      \draw (23) -- node[swap] {$h_2$} (22);
      % vertical lines
      \draw (12) -- node {$v_1$} (22);
      \draw (13) -- node {} (23);
      \draw (23) -- node {$v_2$} (33);
      % pullback symbol
      \node at (3.1,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
    \end{tikzpicture}\]  
  \end{itemize}
\end{remark}

\begin{remark}
  Let $(\C,E)$ be a geometric setup.
  We have the canonical inclusions
  \begin{align*}
    \C^{\myop} \subseteq \Corr(\C,E)
  \end{align*}
  defined by mapping $X \xrightarrow{f} Y$ to $Y \xleftarrow{f} X \xrightarrow{\id_X} X$ and 
  \begin{align*}
    \C_E \subseteq \Corr(\C,E)
  \end{align*}
  defined by mapping $X \xrightarrow{f} Y$ to $X \xleftarrow{\id_X} X \xrightarrow{f} Y$.
\end{remark}

\begin{notation}
  Let $\C$ be a category.
  We denote by $\C^{\coprod} \to \Fin_{*}$ the operad described in \cite{HA} Proposition 2.4.3.3.
  Then the fiber $\C^{\coprod}_{\angle{n}}$ is equivalent to $\C^{n}$ for every $n \geq 0$.
\end{notation}

\begin{definition}[\cite{Mann22} Definition A.5.3] \label{Mann.def.A.5.3}
  Let $(\C,E)$ be a geometric setup.
  We define the class $E'$ of morphisms in $(\C^{\myop})^{\coprod,\myop}$ as follows:
  Let $f$ be a morphism in $(\C^{\myop})^{\coprod,\myop}$ which lies over $\alpha : \angle{m} \to \angle{n}$ in $\Fin_{*}$ of the form $(\angle{n}, (Y_j)_{1 \leq j \leq n}) \to (\angle{m}, (X_i)_{1 \leq i \leq m})$.
  Then $E'$ consists of those $f$ for which $\alpha$ is the identity map, and the each induced map $Y_i \to X_i$ belongs to $E$.
\end{definition}

\begin{definition}[\cite{Mann22} Definition A.5.4] \label{Mann.def.A.5.4}
  Let $(\C,E)$ be a geometric setup.
  We denote 
  \begin{align*}
    \Corr(\C,E)^{\otimes} := \Corr((\C^{\myop})^{\coprod,\myop}, E').
  \end{align*}
  According to \cite{LZ17} Lemma 6.1.3, there exists the canonical functor 
  \begin{align*}
    \Corr(\C,E)^{\otimes} \to \Fin_{*}
  \end{align*}
  which endows an operad structure on $\Corr(\C,E)^{\otimes}$ whose underlying category is $\Corr(\C,E)$.
\end{definition}

\begin{remark} \label{Mann.A.5.5}
  Let $\C$ be a category which admits finite products.
  Then $\C$ admits a unique symmetric monoidal structure whose operation is the Cartesian product.
  In particular, the category $\Cat$ admits the product symmetric monoidal structure.
  By \cite{LZ17} Lemma 6.1.3, $\Corr(\C,E)^{\otimes}$ is a symmetric monoidal category.
\end{remark}  

\begin{definition}[\cite{Mann22} Definition A.5.6] \label{Mann.def.A.5.6}
  Let $(\C,E)$ be a geometric setup.
  A \textit{3-functor formalism} on $(\C,E)$ is a lax symmetric monoidal functor
  \begin{align*}
    D : \Corr(\C,E) \to \Cat.
  \end{align*}
  Equivalently, it is a functor 
  \begin{align*}
    D : \Corr(\C,E)^{\otimes} \to \Cat^{\otimes}
  \end{align*}
  such that for every finite set $I$ and a set of objects $(X_i)_{i \in I}$ of $\C$, the functor 
  \begin{align*}
    D(I,(X_i)_{i \in I}) \to \prod_{i \in I} D(X_i)
  \end{align*}
  is an equivalence in $\Cat^{\otimes}$.
\end{definition}

\begin{remark}
  Let $(\C,E)$ be a geometric setup.
  Then the inclusion $(\C^{\myop})^{\coprod,\myop} \subseteq \Corr(\C,E)^{\otimes}$ is a lax symmetric monoidal functor.
  Let $ D : \Corr(\C,E)^{\otimes} \to \Cat^{\otimes}$ be a 3-functor formalism on $(\C,E)$.
  From \cite{HA} Theorem 2.4.3.18, the restriction (it is a lax symmetric monoidal functor)
  \begin{align*}
    D|_{(\C^{\myop})^{\coprod,\myop}} : (\C^{\myop})^{\coprod,\myop} \subseteq \Corr(\C,E)^{\otimes} \to \Cat^{\otimes}
  \end{align*}
  corresponds to a functor 
  \begin{align*}
    D^{*} : \C^{\myop} \to \CMon(\Cat).
  \end{align*}
  By the restriction, we obtain a functor 
  \begin{align*}
    D_{!} := D|_{\C_{E}} : \C_{E} \subseteq \Corr(\C,E) \to \Cat.
  \end{align*}
\end{remark}

\begin{notation}
  Let $(\C,E)$ be a geometric setup, and let $ D : \Corr(\C,E)^{\otimes} \to \Cat^{\otimes}$ be a 3-functor formalism on $(\C,E)$.
  We will use the following notations:
  \begin{enumerate}
    \item For every object $X$ of $\C$, the category $D(X)=D^{*}(X)$ admit a symmetric monoidal structure, which we denote by 
    \begin{align*}
      \otimes : D(X) \times D(X) \to D(X).
    \end{align*}
    \item For every morphism $f : X \to Y$ in $\C$, we obtain a symmetric monoidal functor 
    \begin{align*}
      f^{*} := D^{\ast}(f) : D(Y) \to D(X).
    \end{align*}
    \item For every morphism $f : X \to Y$ in $E$, we obtain a functor
    \begin{align*}
      f_{!} := D_{!}(f) : D(X) \to D(Y).
    \end{align*}
  \end{enumerate}
\end{notation}

\begin{definition}[\cite{Mann22} Definition A.5.7] \label{Mann.def.A.5.7}
  Let $(\C,E)$ be a geometric setup.
  A \textit{6-functor formalism} on $(\C,E)$ is a 3-functor formalism $ D : \Corr(\C,E)^{\otimes} \to \Cat^{\otimes}$ on $(\C,E)$ which satisfies the following conditions:
  \begin{enumerate}
    \item For every object $X$ of $\C$, the symmetric monoidal structure on $D(X)$ is closed.
    \item The functors $f^{*} : D(Y) \to D(X)$ and $f_! : D(X) \to D(Y)$ admit right adjoint functors.
  \end{enumerate}
\end{definition}

\begin{notation}
  Let $(\C,E)$ be a geometric setup, and let $D : \Corr(\C,E)^{\otimes} \to \Cat^{\otimes}$ be a 6-functor formalism on $(\C,E)$.
  We will use the following notations:
  \begin{enumerate}
    \item We denote the internal hom in $D(X)$ (i.e. the right adjoint functor to $\otimes$) by 
    \begin{align*}
      \underline{\Hom} : D(X)^{\myop} \times D(X) \to D(X).
    \end{align*}
    \item For every morphism $f : X \to Y$ in $\C$, we denote the right adjoint functor to $f^{*}$ by 
    \begin{align*}
      f_{*} : D(X) \to D(Y).
    \end{align*}
    We denote by $D_{*} : \C \to \Cat$ determined by the constructions $X \mapsto D(X)$ and $f \mapsto f_{*}$.
    \item For every morphism $f : X \to Y$ in $E$, we denote the right adjoint functor to $f_{!}$ by 
    \begin{align*}
      f^{!} : D(Y) \to D(X).
    \end{align*}
    We denote by $D^{!} : \C_{E}^{\myop} \to \Cat$ determined by the constructions $X \mapsto D(X)$ and $f \mapsto f^{!}$.
  \end{enumerate}
\end{notation}

\begin{proposition}[\cite{Mann22} Proposition A.5.8] \label{Mann.prop.A.5.8}
  Let $(\C,E)$ be a geometric setup, and let $ D : \Corr(\C,E)^{\otimes} \to \Cat^{\otimes}$ be a 6-functor formalism on $(\C,E)$.
  Then the associated six functors $\otimes, \underline{\Hom}, f^{*}, f_{*}, f_{!}$ and $f^{!}$ satisfy the following conditions:
  \begin{enumerate}
    \item The functors $f^{*}, f_{\ast}, f_{!}$ and $f^{!}$ are compatible with composition.
    \item For every morphism $f : X \to Y$ in $\C$, the functor $f^{*} : D(Y) \to D(X)$ is symmetric monoidal.
    \item (Proper Base Change) For every Cartesian diagram in $\C$ 
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$X'$}; 
      \node (tr) at (1.5,1.5) {$X$};
      \node (bl) at (0,0) {$Y'$}; 
      \node (br) at (1.5,0) {$Y,$}; 
      % horizontal lines
      \draw (tl) -- node {$g'$} (tr); 
      \draw (bl) -- node[swap] {$g$} (br); 
      % vertical lines
      \draw (tl) -- node[swap] {$f'$} (bl);
      \draw (tr) -- node {$f$} (br); 
      % pullback symbol (\lrcorner) in the lower right corner of (tl)
      \node at ([xshift=0.0cm, yshift=-0.2cm] tl.south east) {$\lrcorner$};
    \end{tikzpicture}\]
    where $f$ in $E$ (thus also $f'$ in $E$), there exists a natural equivalence
    \begin{align*}
      g^{*}f_{!} \simeq f'_{!}g'^{*}
    \end{align*}
    of functors $D(X) \to D(Y')$.
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$D(X')$}; 
      \node (tr) at (2,1.5) {$D(X)$};
      \node (bl) at (0,0) {$D(Y')$}; 
      \node (br) at (2,0) {$D(Y).$}; 
      % horizontal lines
      \draw (tr) -- node[swap] {$g'^{*}$} (tl); 
      \draw (br) -- node {$g^{*}$} (bl); 
      % vertical lines
      \draw (tl) -- node[swap] {$f'_{!}$} (bl);
      \draw (tr) -- node {$f_{!}$} (br); 
    \end{tikzpicture}\]
    \item (Projection Formula) For every morphism $f : X \to Y$ in $E$,
    there exists a natural equivalence
    \begin{align*}
      f_{!}(-) \otimes (-) \to f_{!}((-) \otimes f^{*}(-))
    \end{align*}
    of functors $D(X) \times D(Y) \to D(Y)$.
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,3) {$D(Y) \times D(Y)$}; 
      \node (tr) at (4,3) {$D(X) \times D(Y)$};
      \node (mr) at (4,1.5) {$D(X) \times D(X)$};
      \node (bl) at (0,0) {$D(Y)$}; 
      \node (br) at (4,0) {$D(X).$}; 
      % horizontal lines
      \draw (tr) -- node[swap] {$(f_!,\id_{D(Y)})$} (tl); 
      \draw (br) -- node {$f_{!}$} (bl); 
      % vertical lines
      \draw (tl) -- node[swap] {$\otimes$} (bl);
      \draw (tr) -- node {$(\id_{D(X)},f^{*})$} (mr);
      \draw (mr) -- node {$\otimes$} (br); 
    \end{tikzpicture}\]
  \end{enumerate}
\end{proposition}

\begin{proof}
  (1) and (2) follow from the definitions.

  The morphisms $f : X \to Y$ in $E$ and $g : Y' \to Y$ in $\C$ determine correspondences $h_1$ and $h_2$ respectively.
  \[\begin{tikzpicture}[auto]
    \node (11) at (0,1.5) {$X$};
    \node (12) at (1.5,1.5) {$X$};
    \node (13) at (3,1.5) {$Y$};
    \node (14) at (4.5,1.5) {$Y'$};
    \node (22) at (1.5,0) {$Y$};
    \node (24) at (4.5,0) {$Y'.$};
    % horizontal lines
    \draw[transform canvas={yshift=1.5pt}] (12) -- (11);
    \draw[transform canvas={yshift=-1.5pt}] (12) -- (11);   
    \draw[->] (14) -- node[swap] {$g$} (13);
    % vertical lines
    \draw[->] (12) -- node {$f$} (22);
    \draw[transform canvas={xshift=1.5pt}] (14) -- (24);
    \draw[transform canvas={xshift=-1.5pt}] (14) -- (24);
  \end{tikzpicture}\]

  The composition $h_1h_2$ is given by the correspondence
  \[\begin{tikzpicture}[auto]
    \node (11) at (0,3) {$X$};
    \node (12) at (1.5,3) {$X$};
    \node (13) at (3,3) {$X'$};
    \node (22) at (1.5,1.5) {$Y$};
    \node (23) at (3,1.5) {$Y'$};
    \node (33) at (3,0) {$Y'.$};
    % horizontal lines
    \draw[transform canvas={yshift=1.5pt}] (12) -- (11);
    \draw[transform canvas={yshift=-1.5pt}] (12) -- (11);   
    \draw[->] (13) -- node[swap] {$g'$} (12);
    \draw[->] (23) -- node[swap] {$g$} (22);
    % vertical lines
    \draw[->] (12) -- node {$f$} (22);
    \draw[->] (13) -- node {$f'$} (23);
    \draw[transform canvas={xshift=1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=-1.5pt}] (23) -- (33);
    % pullback symbol
    \node at (2.6,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
  \end{tikzpicture}\]
  The first map $h_1 : X \xleftarrow{\id_X} X \xrightarrow{f} Y$ defines a functor 
  \begin{align*}
    f_! : D(X) \to D(Y).
  \end{align*}
  The second map $h_2 : Y \xleftarrow{g'} Y' \xrightarrow{\id_Y} Y'$ defines a functor 
  \begin{align*}
    g^{*} : D(Y) \to D(Y').
  \end{align*}
  The composition $h_1h_2 : X \xleftarrow{g'} X' \xrightarrow{f'} Y'$ defines a functor
  \begin{align*}
    f'_{!}g'^{*} : D(X) \to D(Y').
  \end{align*}
  Thus we obtain a natural equivalence $g^{*}f_{!} \simeq f'_{!}g'^{*}$, since $D$ is a functor.

  We finally show (4).
  Let $f : X \to Y$ be a morphism in $E$.
  We consider the map $X \times Y \to Y$ given by the correspondence
  \[\begin{tikzpicture}[auto,->]
    \node (11) at (-0.5,3) {$X \times Y$};
    \node (12) at (1.5,3) {$X$};
    \node (22) at (1.5,1.5) {$Y.$};
    % horizontal lines
    \draw (12) -- node[swap] {$(\id_X,f)$} (11);
    % vertical lines
    \draw (12) -- node {$f$} (22);
  \end{tikzpicture}\]
  We obtain its two factorizations as follows:
  The map $X \times Y \to Y \times Y \to Y$ which is given by the correspondence
  \[\begin{tikzpicture}[auto]
    \node (11) at (-0.5,3) {$X \times Y$};
    \node (12) at (1.5,3) {$X \times Y$};
    \node (13) at (3.5,3) {$X$};
    \node (22) at (1.5,1.5) {$Y \times Y$};
    \node (23) at (3.5,1.5) {$Y$};
    \node (33) at (3.5,0) {$Y.$};
    % horizontal lines
    \draw[transform canvas={yshift=1.5pt}] (12) -- (11);
    \draw[transform canvas={yshift=-1.5pt}] (12) -- (11);
    \draw[->] (13) -- node[swap] {$(\id_X,f)$} (12);
    \draw[->] (23) -- node[swap]{$\Delta_Y$} (22);
    % vertical lines
    \draw[->] (12) -- node {$(f,\id_X)$} (22);
    \draw[->] (13) -- node {$f$} (23);
    \draw[transform canvas={xshift=1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=-1.5pt}] (23) -- (33);
    % pullback symbol
    \node at (3.1,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
  \end{tikzpicture}\]
  The map $X \times Y \to X \times X \to X \to Y$ which is given by the correspondence
  \[\begin{tikzpicture}[auto]
    \node (11) at (-1.5,4.5) {$X \times Y$};
    \node (12) at (1.0,4.5) {$X \times X$};
    \node (13) at (3,4.5) {$X$};
    \node (14) at (4.5,4.5) {$X$};
    \node (22) at (1.0,3) {$X \times X$};
    \node (23) at (3,3) {$X$};
    \node (24) at (4.5,3) {$X$};
    \node (33) at (3,1.5) {$X$};
    \node (34) at (4.5,1.5) {$X$};
    \node (44) at (4.5,0) {$Y.$};
    % horizontal lines
    \draw[->] (12) -- node[swap] {$(\id_X,f)$} (11);
    \draw[->] (13) -- node[swap] {$\Delta_X$} (12);
    \draw[transform canvas={yshift=1.5pt}] (14) -- (13);
    \draw[transform canvas={yshift=-1.5pt}] (14) -- (13);   
    \draw[->] (23) -- node[swap] {$\Delta_X$} (22);
    \draw[transform canvas={yshift=1.5pt}] (24) -- (23);
    \draw[transform canvas={yshift=-1.5pt}] (24) -- (23);  
    \draw[transform canvas={yshift=1.5pt}] (34) -- (33);
    \draw[transform canvas={yshift=-1.5pt}] (34) -- (33);  
    % vertical lines
    \draw[transform canvas={xshift=1.5pt}] (12) -- (22);
    \draw[transform canvas={xshift=-1.5pt}] (12) -- (22);
    \draw[transform canvas={xshift=1.5pt}] (13) -- (23);
    \draw[transform canvas={xshift=-1.5pt}] (13) -- (23);
    \draw[transform canvas={xshift=1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=-1.5pt}] (23) -- (33);
    \draw[transform canvas={xshift=1.5pt}] (14) -- (24);
    \draw[transform canvas={xshift=-1.5pt}] (14) -- (24);
    \draw[transform canvas={xshift=1.5pt}] (24) -- (34);
    \draw[transform canvas={xshift=-1.5pt}] (24) -- (34);
    \draw[transform canvas={xshift=1.5pt}] (34) -- (34);
    \draw[transform canvas={xshift=-1.5pt}] (34) -- (34);
    \draw[->] (34) -- node {$f$} (44);
    % pullback symbol
    \node at (2.6,4.1) {\rotatebox[origin=c]{90}{$\ulcorner$}};
    \node at (4.1,4.1) {\rotatebox[origin=c]{90}{$\ulcorner$}};
    \node at (4.1,2.6) {\rotatebox[origin=c]{90}{$\ulcorner$}};
  \end{tikzpicture}\]
  The map $X \times Y \xleftarrow{(\id_X,f)} X \xrightarrow{f} Y$ defines a functor 
  \begin{align*}
    D(X) \times D(Y) \to D(Y).
  \end{align*}
  The first factorization $X \times Y \xleftarrow{(\id_X,f)} X \xrightarrow{f} Y$ defines a functor
  \begin{align*}
    D(X) \times D(Y) \to D(Y) \times D(Y) \to D(Y) 
    : (F,G) \to (f_{!}F, G) \mapsto f_{!}F \otimes G.
  \end{align*}
  The second factorization $X \times Y \xleftarrow{(\id_X,f)} X \times X \xleftarrow{\Delta_X} X \xrightarrow{f} Y$ defines a functor 
  \begin{align*}
    D(X) \times D(Y) \to D(X) \times D(X) \to D(X) \to D(Y) 
    : (F,G) \mapsto (F,f^{*}G) \mapsto F \otimes f^{*}G \mapsto f_!(F \otimes f^{*}G).
  \end{align*}
  This implies that a map $f_{!}F \otimes G \to f_!(F \otimes f^{*}G)$ is an equivalence in $D(Y)$, since $D$ is a functor.
\end{proof} 

\subsection{With Suitable Decompositions} \label{subsec.with_suitable_decompositions}

In practice, there are two special subclasses of morphisms $I$ and $P$ of $E$ of "open immersions" and "proper maps", which satisfies the following conditions:
\begin{enumerate}
  \item For every morphism $f$ in $I$, $f_{!}$ is left adjoint to $f^{*}$. i.e. $f_! \dashv f^{*}$.
  \item For every morphism $f$ in $P$, $f_{!}$ is right adjoint to $f^{*}$. i.e. $f^{*} \dashv f_!$ and $f_{!} = f_{*}$.
  \item Every morphism $f$ in $E$ admits a factorization $f=\overline{f}j$, where $j$ in $I$ and $\overline{f}$ in $P$. 
  \item The functor $f_{!}$ is compatible with the above factorization. i.e. $f_{!} = \overline{f}_{!}j_{!}$.
\end{enumerate}

\begin{example} \label{Sch.eg.4.1}
  Let $\C$ be the category of locally compact Hausdorff topological spaces, and $E$ be the class of all morphisms.
  Let $I$ and $P$ be the classes of open immersions and proper maps, respectively.
  Then every morphism $f$ in $E (= \C)$ admits a factorization $X \xrightarrow{j} \overline{X} \xrightarrow{\overline{f}} Y$, where $j$ in $I$ and $\overline{f}$ in $P$.
  For example, we can choose $\overline{X} = \beta X \times_{\beta Y} Y$ using the Stone-\v{C}ech compactification. 
\end{example}

However, it is not obvious that $f_{!}$ is well-defined i.e. $f_{!}$ is independent on the choice of the factorization and it satisfies the required compatibilities for 6-functor formalisms.
We need the following conditions to make the above construction work.

\begin{definition}[\cite{Mann22} Definition A.5.9] \label{Mann.def.A.5.9}
  Let $(\C,E)$ be a geometric setup.
  We will say that $E$ \textit{has a suitable decomposition} $(I,P)$ if there exists a pair of subclasses of morphisms $(I,P)$ of $E$ which satisfies the following conditions:
  \begin{enumerate}
    \item The classes $I$ and $P$ contain all equivalences, and are stable under composition and pullbacks.
    \item Every morphism $f$ in $E$ admits a factorization $f=\overline{f}j$, where $j$ in $I$ and $\overline{f}$ in $P$.
    \item Let $f : X \to Y$ and $g : Y \to Z$ be morphisms in $\C$.
    If $g$ is in $I$ (resp. $g$ in $P$), then $f$ is in $I$ (resp. $f$ in $P$) if and only if $gf$ is in $I$ (resp. $gf$ in $P$).
    \item Every morphism $f$ in $I \cap P$ is $n$-truncated for some $n > -2$ (which may depend on $f$).
  \end{enumerate}
\end{definition}

\begin{definition}
  Let $(\C,E)$ be a geometric setup, and let $D^{*} : \C^{\myop} \to \CMon(\Cat)$ be a functor.
  Suppose that $E$ has a suitable decomposition $(I,P)$.
  For every morphism $f : X \to Y$ in $\C$, we denote $f^{*} := D^{*}(f) : D^{*}(Y) \to D^{*}(X)$.
  We will say that $D^{*}$ \textit{satisfies a suitable decomposition condition} for $(I,P)$ if it satisfies the following conditions:
  \begin{enumerate}
    \item For every morphism $j$ in $I$, the functor $j^{*}$ admits a left adjoint functor $j_{!}$, which satisfies the proper base change and (proper) projection formula.
    \item For every morphism $g$ in $P$, the functor $g^{*}$ admits a right adjoint functor $g_{*}$, which satisfies the $*$-version base change and $*$-version projection formula.
    \item For every Cartesian diagram in $\C$
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$X'$}; 
      \node (tr) at (1.5,1.5) {$X$};
      \node (bl) at (0,0) {$Y'$}; 
      \node (br) at (1.5,0) {$Y,$}; 
      % horizontal lines
      \draw (tl) -- node {$j'$} (tr); 
      \draw (bl) -- node[swap] {$j$} (br); 
      % vertical lines
      \draw (tl) -- node[swap] {$g'$} (bl);
      \draw (tr) -- node {$g$} (br); 
      % pullback symbol (\lrcorner) in the lower right corner of (tl)
      \node at ([xshift=0.0cm, yshift=-0.2cm] tl.south east) {$\lrcorner$};
    \end{tikzpicture}\]
    where $j$ in $I$ (thus also $j'$ in $I$), and $g$ in $P$ (thus also $g'$ in $P$), there exists a natural equivalence
    \begin{align*}
      j_{!}g'_{*} \to g_{*}j'_{!}
    \end{align*}
    of functors $D^{*}(X') \to D^{*}(Y)$.
    \[\begin{tikzpicture}[auto,->] 
      \node (tl) at (0,1.5) {$D^{*}(X')$}; 
      \node (tr) at (2,1.5) {$D^{*}(X)$};
      \node (bl) at (0,0) {$D^{*}(Y')$}; 
      \node (br) at (2,0) {$D^{*}(Y).$}; 
      % horizontal lines
      \draw (tl) -- node {$j'_{!}$} (tr); 
      \draw (bl) -- node[swap] {$j_{!}$} (br); 
      % vertical lines
      \draw (tl) -- node[swap] {$g_{*}$} (bl);
      \draw (tr) -- node {$g_{*}$} (br); 
    \end{tikzpicture}\]
  \end{enumerate}
\end{definition}

\begin{proposition}[\cite{Mann22} Proposition A.5.10] \label{Mann.prop.A.5.10}
  Let $(\C,E)$ be a geometric setup.
  Suppose that $E$ has a suitable decomposition $(I,P)$.
  Let $D^{*} : \C^{\myop} \to \CMon(\Cat)$ be a functor which satisfies a suitable decomposition condition for $(I,P)$.
  Then $D^{*}$ can be extended to a 3-functor formalism 
  \begin{align*}
    D : \Corr(\C,E)^{\otimes} \to \Cat^{\otimes},
  \end{align*}
  on $(\C,E)$ such that for every morphism $j$ in $I$, $j_{!}$ is left adjoint to $j^{*}$, and for every morphism $g$ in $P$, $g_{!}$ is right adjoint to $g^{*}$.

  Suppose additionally that $D$ satisfies the following conditions:
  \begin{enumerate}
    \item For every object $X$ of $\C$, the symmetric monoidal structure on $D(X)$ is closed.
    \item For every morphism $f : X \to Y$ in $\C$, the functor $f^{*} : D(Y) \to D(X)$ admit a right adjoint functor $f_{*} : D(X) \to D(Y)$.
    \item For every morphism $g : X \to Y$ in $P$, the functor $f_{*}=f_{!} : D(X) \to D(Y)$ admit a right adjoint functor $f^{!} : D(Y) \to D(X)$.
  \end{enumerate}
  Then the above 3-functor formalism $D$ is a 6-functor formalism on $(\C,E)$. 
\end{proposition}

\appendix 
